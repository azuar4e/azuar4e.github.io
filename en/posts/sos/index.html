<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>RESTful Service - azuar4e</title><meta name=author content="Angel Azuara Eizaguirre"><meta name=description content="An university project for the course System Oriented Services."><meta name=keywords content='Java,Spring,API'><meta itemprop=name content="RESTful Service"><meta itemprop=description content="An university project for the course System Oriented Services."><meta itemprop=datePublished content="2025-06-17T12:30:24+02:00"><meta itemprop=dateModified content="2025-06-17T12:30:24+02:00"><meta itemprop=wordCount content="4522"><meta itemprop=keywords content="Java,Spring,API"><meta property="og:url" content="https://azuar4e.github.io/en/posts/sos/"><meta property="og:site_name" content="azuar4e"><meta property="og:title" content="RESTful Service"><meta property="og:description" content="An university project for the course System Oriented Services."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-17T12:30:24+02:00"><meta property="article:modified_time" content="2025-06-17T12:30:24+02:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="Spring"><meta property="article:tag" content="API"><meta name=twitter:card content="summary"><meta name=twitter:title content="RESTful Service"><meta name=twitter:description content="An university project for the course System Oriented Services."><meta name=twitter:site content="@azuar4e"><meta name=twitter:creator content="@azuar4e"><meta name=application-name content="azuar4e"><meta name=apple-mobile-web-app-title content="azuar4e"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://azuar4e.github.io/en/posts/sos/ title="RESTful Service - azuar4e"><link rel=prev type=text/html href=https://azuar4e.github.io/en/about/ title="About Me"><link rel=next type=text/html href=https://azuar4e.github.io/en/posts/tdl/ title="Language Translator"><link rel=alternate type=text/markdown href=https://azuar4e.github.io/en/posts/sos/index.md title="RESTful Service - azuar4e"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"RESTful Service","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/azuar4e.github.io\/en\/posts\/sos\/"},"genre":"posts","keywords":"Java, Spring, API","wordcount":4522,"url":"https:\/\/azuar4e.github.io\/en\/posts\/sos\/","datePublished":"2025-06-17T12:30:24+02:00","dateModified":"2025-06-17T12:30:24+02:00","publisher":{"@type":"Organization","name":"azuar4e","logo":"https:\/\/azuar4e.github.io\/images\/avatar.jpg"},"author":{"@type":"Person","name":"Angel Azuara Eizaguirre"},"description":"An university project for the course System Oriented Services."}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/en/ title=azuar4e><span class=header-title-text>azuar4e</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/en/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/en/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/en/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/en/about/><i class="fa-solid fa-quote-left fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label="Select Language" title="Select Language"><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><span class=text-secondary title=English>English</span></li><li class=menu-item><a href=/es/posts/sos/ class=menu-link title=Español>Español</a></li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/en/ title=azuar4e><span class=header-title-text>azuar4e</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></li><li class=menu-item><a class=menu-link href=/en/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archives</a></li><li class=menu-item><a class=menu-link href=/en/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categories</a></li><li class=menu-item><a class=menu-link href=/en/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><a class=menu-link href=/en/about/><i class="fa-solid fa-quote-left fa-fw fa-sm" aria-hidden=true></i> About</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label="Select Language" title="Select Language">English<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option value=/en/posts/sos/ selected disabled>English</option><option value=/es/posts/sos/>Español</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item data-separator=/><a href=/en/posts/ title=Posts>Posts</a></li><li class="breadcrumb-item active" data-separator=/ aria-current=page>RESTful Service</li></ol></nav><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=Collections><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>Related Content</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/en/posts/tdl/ title="Language Translator">Language Translator</a></li></ul></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>RESTful Service</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://www.linkedin.com/in/angel-azuara/ title=Author target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=/images/avatar.jpg alt="Angel Azuara Eizaguirre" height=16 width=16>&nbsp;Angel Azuara Eizaguirre</a></span><span class=post-included-in>&nbsp;included in <a href=/en/categories/university/ class=post-category title="Category - University"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> University</a>&ensp;<a href=/en/categories/personal-projects/ class=post-category title="Category - Personal Projects"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Personal Projects</a></span></div><div class=post-meta-line><span title="published on 2025-06-17 12:30:24"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-06-17>2025-06-17</time></span>&nbsp;<span title="4522 words"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>About 4600 words</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>22 minutes</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#overview>Overview</a></li><li><a href=#rest-api-design>REST API Design</a><ol><li><a href=#-books>📚 Books</a></li><li><a href=#-loans>📄 Loans</a></li><li><a href=#-users>👤 Users</a></li></ol></li><li><a href=#architecture>Architecture</a><ol><li><a href=#models>Models</a></li><li><a href=#repositories>Repositories</a></li><li><a href=#services>Services</a></li><li><a href=#controllers>Controllers</a></li><li><a href=#exceptions>Exceptions</a></li></ol></li><li><a href=#client>Client</a></li><li><a href=#usage>Usage</a></li><li><a href=#usage-example>Usage Example</a></li><li><a href=#conclusion>Conclusion</a></li></ol></nav></div></div><div class=content id=content><h2 class=heading-element id=introduction><span>1 Introduction</span>
<a href=#introduction class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>This project implements a RESTful web service (REST API) in Java using the Spring Framework and Maven.<br>It was developed as part of the <strong>Service-Oriented Systems</strong> course in the Computer Science degree. All the source code is available in my <a href=https://github.com/azuar4e/RESTful-Service target=_blank rel="external nofollow noopener noreferrer">GitHub repository</a>.</p><blockquote><p>⚠️ <strong>Note:</strong> Since the course is taught in Spanish, all source code, directories, and documentation are in Spanish.</p></blockquote><hr><h2 class=heading-element id=overview><span>2 Overview</span>
<a href=#overview class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>The service provides basic functionality for managing book loans in a library. In the following image we can see the entity-relationship model:</p><p><a class=lightgallery href=/en/posts/sos/images/er-model.png title="Entity-Relationship Model" data-thumbnail=/en/posts/sos/images/er-model.png data-sub-html="<h2>Entity-Relationship Model</h2>"><img loading=lazy src=/en/posts/sos/images/er-model.png alt="Entity-Relationship Model" height=271 width=761></a></p><blockquote><p><strong>Note:</strong> The relation <code>books-loans</code> is intended to be a one-one relationship but our implementation allows multiple loans per book as long as the book is available.</p></blockquote><h2 class=heading-element id=rest-api-design><span>3 REST API Design</span>
<a href=#rest-api-design class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>The root URL of the service is <code>http://localhost:8080/biblioteca.api/</code>.</p><p>The API exposes three resources:</p><ul><li><code>/libros</code> (books)</li><li><code>/users</code></li><li><code>/prestamos</code> (loans)</li></ul><p>Each one allows full CRUD operations (<code>Create</code>, <code>Read</code>, <code>Update</code>, <code>Delete</code>), using the standard HTTP methods (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>).</p><p>The following <strong>endpoints</strong> are available:</p><h3 class=heading-element id=-books><span>3.1 📚 Books</span>
<a href=#-books class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><code>GET /libros</code></li><li><code>GET /libros/{isbn}</code></li><li><code>GET /libros/{isbn}/unidades</code> – Number of available copies</li><li><code>GET /libros?titulo_contiene={titulo}</code> – Search by title</li><li><code>GET /libros?disponible={true|false}</code> – Search by availability</li><li><code>POST /libros</code></li><li><code>PUT /libros/{isbn}</code></li><li><code>DELETE /libros/{isbn}</code></li></ul><hr><h3 class=heading-element id=-loans><span>3.2 📄 Loans</span>
<a href=#-loans class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><code>GET /prestamos</code></li><li><code>GET /prestamos/{id}</code></li><li><code>POST /prestamos</code></li><li><code>PUT /prestamos/{id}</code> – Return book or verify loan (set <code>devuelto</code> attribute to <code>true</code> || set <code>verificar_devolucion</code> to <code>true</code>)</li><li><code>DELETE /prestamos/{id}</code></li></ul><hr><h3 class=heading-element id=-users><span>3.3 👤 Users</span>
<a href=#-users class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><code>GET /users</code></li><li><code>GET /users/{matricula}</code> – Student ID</li><li><code>GET /users/{matricula}/prestamos</code> – Loans by student</li><li><code>PUT /users/{matricula}/prestamos/{id}</code> – Extend loan (set <code>ampliar</code> attribute to <code>true</code>)</li><li><code>GET /users/{matricula}/actividad</code> – Student&rsquo;s activity</li><li><code>POST /users</code></li><li><code>PUT /users/{matricula}</code></li><li><code>DELETE /users/{matricula}</code></li></ul><hr><h2 class=heading-element id=architecture><span>4 Architecture</span>
<a href=#architecture class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>The project follows the <strong>Controller-Service-Repository</strong> pattern, with the following structure:</p><ul><li><strong>Model:</strong> Represents the database information through entities, relationships, and attributes (the tables).</li><li><strong>Repository:</strong> Responsible for directly interacting with the database.</li><li><strong>Service:</strong> Contains the application logic and communicates with the repository to process data.</li><li><strong>Controller:</strong> Manages HTTP requests and responses, connecting the client with the service logic.</li></ul><p>As shown in the following image, this is the structure of the project:</p><p><a class=lightgallery href=/en/posts/sos/images/architecture.png title=Architecture data-thumbnail=/en/posts/sos/images/architecture.png data-sub-html="<h2>Architecture</h2>"><img loading=lazy src=/en/posts/sos/images/architecture.png alt=Architecture height=571 width=1224></a></p><p>In the <strong>Exceptions</strong> folder, all error types for each resource are declared, along with their corresponding HTTP status codes.</p><blockquote><p>All the code shown below will be related to <em>loans</em> since it&rsquo;s the entity that links books and users, and therefore it&rsquo;s the most representative of the API’s general behavior.</p></blockquote><h3 class=heading-element id=models><span>4.1 Models</span>
<a href=#models class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>The first step is to define the entities that make up the database. To do this, we declare two classes for each entity within the <strong>models</strong> folder:</p><ul><li>One class where we define the table and its attributes.</li><li>Another one containing the <code>ModelAssembler</code>, which allows us to add <code>HATEOAS</code> links to the resources.</li></ul><p>Below is the model for the <code>Prestamo</code> (Loan) entity, which makes use of:</p><ul><li><strong>Lombok</strong> (<code>@Data</code>, <code>@NoArgsConstructor</code>, <code>@AllArgsConstructor</code>) to automatically generate getters, setters, and constructors.</li><li><strong>JPA</strong> (<code>@Entity</code>, <code>@Table</code>, <code>@Id</code>, etc.) to map the class to a table in the database.</li><li><strong>Spring HATEOAS</strong> (<code>extends RepresentationModel&lt;Prestamo></code>) to add HATEOAS links to the resources via the <code>ModelAssembler</code>.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.hateoas.RepresentationModel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.annotation.JsonBackReference</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.persistence.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Prestamo&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Prestamo</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RepresentationModel</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;usuario_id&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>//user_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JsonBackReference</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Usuario</span><span class=w> </span><span class=n>usuario</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;libro_id&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>//book_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;fecha_prestamo&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=c1>//loan_date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;fecha_devolucion&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=c1>//return_date</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>columnDefinition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;boolean default false&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>//returned</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>devuelto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>columnDefinition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;boolean default false&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>//verified_return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>verificar_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ampliar&#34;</span><span class=p>,</span><span class=w> </span><span class=n>columnDefinition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;boolean default false&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>//extend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>ampliar</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><code>@Id</code> marks the identifier of the entity, and we auto-generate it using <code>@GeneratedValue</code>.</p><p><code>usuario</code> and <code>libro</code> represent <em>ManyToOne</em> relationships with their respective entities.</p><ul><li>In the case of the user, we use <code>@JsonBackReference</code> to avoid cyclic serialization. This is because the <strong>Usuario</strong> model includes an attribute named <code>prestamos</code>, which points to the user&rsquo;s loans; that attribute uses <code>@JsonManagedReference</code>. The one annotated with <code>@JsonManagedReference</code> is the side that gets serialized in the returned JSON. In other words, when a user is returned, their loans are included; but when a loan is returned, the user information is not included.</li></ul><p>For the rest of the attributes, we use <code>@Column</code> to indicate that they are fields in the corresponding table, and to define whether they can be null, their default values, etc.</p><p>As for the <code>ModelAssembler</code>, we define it as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.RepresentationModelAssemblerSupport</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Component</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.controllers.PrestamosController</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamoModelAssembler</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RepresentationModelAssemblerSupport</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=p>,</span><span class=w> </span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>PrestamoModelAssembler</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>PrestamosController</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>Prestamo</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Prestamo</span><span class=w> </span><span class=nf>toModel</span><span class=p>(</span><span class=n>Prestamo</span><span class=w> </span><span class=n>entity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>entity</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>linkTo</span><span class=p>(</span><span class=n>methodOn</span><span class=p>(</span><span class=n>PrestamosController</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getPrestamo</span><span class=p>(</span><span class=n>entity</span><span class=p>.</span><span class=na>getId</span><span class=p>())).</span><span class=na>withSelfRel</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>entity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>In the <code>toModel</code> method, a self-link (<code>self</code>) is added using <code>linkTo</code> and <code>methodOn</code>, pointing to the controller method that retrieves a loan by its identifier (<code>getPrestamo(id)</code>).</p><p>This allows the returned <code>Prestamo</code> object to include a link in the JSON response like:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;_links&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;self&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/biblioteca.api/prestamos/1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=repositories><span>4.2 Repositories</span>
<a href=#repositories class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Next, we define the repositories corresponding to each entity. As previously mentioned, these are responsible for directly interacting with the database.</p><p>For the repositories, we use:</p><ul><li><strong>JPA</strong>: We use annotations such as <code>@Repository</code> and <code>@Query</code>, and extend <code>JpaRepository&lt;Prestamo, Integer></code> to gain access to the most common persistence methods (like <code>save</code>, <code>findAll</code>, <code>findById</code>, etc.), as well as the ability to define custom queries.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.repository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models.Libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models.Prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Optional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.domain.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.jpa.repository.JpaRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.jpa.repository.Query</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.repository.query.Param</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Repository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>PrestamosRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsuarioMatriculaAndDevueltoFalse</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;matricula&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//actual loans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;SELECT p FROM Prestamo p WHERE p.usuario.matricula = :matricula AND p.devuelto = false AND p.fecha_devolucion &gt; CURRENT_DATE ORDER BY p.fecha_prestamo DESC&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPrestamosActuales</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;matricula&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>paginable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=c1>//returned loans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;SELECT p FROM Prestamo p WHERE p.usuario.matricula = :matricula AND p.devuelto = true ORDER BY p.fecha_devolucion DESC&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getUltimosLibrosDevueltos</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;matricula&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Prestamo</span><span class=w> </span><span class=nf>findByLibroIsbn</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>The persistence methods mentioned earlier do not require any explicit SQL or JPQL queries: Spring Data automatically infers them based on the method name. The rest are custom queries.</p><ul><li><code>getPrestamosActuales</code> returns the current loans of a user that have not yet been returned and whose return date has not yet passed, ordered by descending loan date.</li><li><code>getUltimosLibrosDevueltos</code> returns the latest books returned by a user, ordered by descending return date.</li></ul><h3 class=heading-element id=services><span>4.3 Services</span>
<a href=#services class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>The following section describes the services that make up the application. These contain the business logic and communicate with the repositories to process data.</p><p>The annotation <code>@Service</code> is used to indicate that this class belongs to the service layer of the application, along with <code>lombok</code>’s <code>@AllArgsConstructor</code>.</p><blockquote><p>Since the file is very long, only a <em>snippet</em> is shown here. For readability, <em>some imports</em> related to models and exceptions have been removed.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.services</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Objects</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Optional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.Logger</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.LoggerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.domain.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.transaction.Transactional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ServicioPrestamos</span><span class=p>{</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PrestamosRepository</span><span class=w> </span><span class=n>repository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>LibrosRepository</span><span class=w> </span><span class=n>repoLibro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UsuariosRepository</span><span class=w> </span><span class=n>userRepo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>ServicioPrestamos</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPrestamos</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Pageable</span><span class=w> </span><span class=n>paginable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PageRequest</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=n>size</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=na>findAll</span><span class=p>(</span><span class=n>paginable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Prestamo</span><span class=w> </span><span class=nf>getPrestamoId</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PrestamoNotFoundException</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>prestamo</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>postPrestamo</span><span class=p>(</span><span class=n>Prestamo</span><span class=w> </span><span class=n>prestamo</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repoLibro</span><span class=p>.</span><span class=na>findByIsbn</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getLibro</span><span class=p>().</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Usuario</span><span class=w> </span><span class=n>usuario</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>().</span><span class=na>getMatricula</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=kt>int</span><span class=w> </span><span class=n>cantidad</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>libro</span><span class=p>.</span><span class=na>getDisponibles</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Servicio postPrestamo&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamoExistente</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Cantidad: &#34;</span><span class=o>+</span><span class=n>cantidad</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>prestamoExistente</span><span class=p>.</span><span class=na>isPresent</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PrestamoConflictException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=p>(</span><span class=n>cantidad</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LibroNoDisponibleException</span><span class=p>(</span><span class=n>libro</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>usuario</span><span class=p>.</span><span class=na>getPor_devolver</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UsuarioDevolucionesPendientesException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>().</span><span class=na>getMatricula</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>usuario</span><span class=p>.</span><span class=na>getSancion</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UsuarioSancionadoException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>().</span><span class=na>getMatricula</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_devolucion</span><span class=p>().</span><span class=na>isBefore</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_prestamo</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FechasNoValidasException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_prestamo</span><span class=p>(),</span><span class=w> </span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_devolucion</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>libro</span><span class=p>.</span><span class=na>setDisponibles</span><span class=p>(</span><span class=n>cantidad</span><span class=o>-</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Cantidad: &#34;</span><span class=o>+</span><span class=w> </span><span class=n>libro</span><span class=p>.</span><span class=na>getDisponibles</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>repoLibro</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>libro</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>repository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>prestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>I have included three different methods, from the simplest to the most complex:</p><ul><li><code>getPrestamos</code>: returns all the loans from the database. We only declare a <code>Pageable</code> to enable pagination, and return whatever the repository returns.</li><li><code>getPrestamoId</code>: returns a loan by its identifier. We use an <code>Optional</code> to handle the possible absence of the resource, throwing a custom exception (which the controller will receive) if the loan is not found.</li><li><code>postPrestamo</code>: allows creating a new loan. Since this method modifies the database, it is annotated with <code>@Transactional</code>. Data is received from the controller (in JSON format), associated entities are extracted, and multiple validations are performed: existence of the loan, availability of the book, user&rsquo;s status, and consistency between dates. If everything is correct, the number of available copies is updated and the loan is saved.</li></ul><h3 class=heading-element id=controllers><span>4.4 Controllers</span>
<a href=#controllers class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Finally, the controllers that make up the application are described. They are responsible for managing HTTP requests and responses, connecting the client with the service logic.</p><p>The <code>@RestController</code> annotation is used to indicate that this class is part of the application&rsquo;s controller layer, along with Lombok&rsquo;s <code>@AllArgsConstructor</code> and the <code>@RequestMapping</code> to indicate the <strong>entry point</strong> to the resource.</p><blockquote><p>Just like with the services, I include a <em>snippet</em> of the controller, omitting some imports.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.controllers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.validation.Valid</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.domain.Page</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.web.PagedResourcesAssembler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.AllArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.ResponseEntity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.Logger</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.LoggerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/biblioteca.api/prestamos&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamosController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>ServicioPrestamos</span><span class=w> </span><span class=n>servicio</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>PagedResourcesAssembler</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>pagedResourcesAssembler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>PrestamoModelAssembler</span><span class=w> </span><span class=n>prestamoModelAssembler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>PrestamosController</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPrestamos</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>page</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;3&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>getPrestamos</span><span class=p>(</span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=n>size</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>pagedResourcesAssembler</span><span class=p>.</span><span class=na>toModel</span><span class=p>(</span><span class=n>prestamos</span><span class=p>,</span><span class=w> </span><span class=n>prestamoModelAssembler</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PutMapping</span><span class=p>(</span><span class=s>&#34;/{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>devolverLibro_verificarDevolucion</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=nd>@Valid</span><span class=w> </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>Prestamo</span><span class=w> </span><span class=n>prestamo</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>isDevuelto</span><span class=p>()){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>//to return a book</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>servicio</span><span class=p>.</span><span class=na>devolverLibro</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>prestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>noContent</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoDevueltoException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>             </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>UsuarioNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>LibroNoCoincideException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>//to verify a return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>servicio</span><span class=p>.</span><span class=na>verificarDevolucion</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>prestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>noContent</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>catch</span><span class=p>(</span><span class=n>PrestamoVerificadoException</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>UsuarioNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>LibroNoCoincideException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DeleteMapping</span><span class=p>(</span><span class=s>&#34;/{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>deletePrestamo</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>servicio</span><span class=p>.</span><span class=na>deletePrestamo</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>noContent</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Just like before, I have included three different methods, from the simplest to the most complex:</p><ul><li><code>getPrestamos</code>: we call the service method with the request parameters (<code>page</code> and <code>size</code>), which default to 0 and 3, and return the result of that call.</li><li><code>devolverLibro_verificarDevolucion</code>: allows us to return a book or verify the return of a loan. Since this method can throw exceptions, we wrap it in a <code>try-catch</code> block to return an error message if any exception occurs, handling exceptions according to the HTTP error code returned.</li><li><code>deletePrestamo</code>: allows us to delete a loan. We call the service method with the loan ID and return the result of that call. If the loan didn’t exist, the exception is caught and an HTTP 404 Not Found status code is returned.</li></ul><h3 class=heading-element id=exceptions><span>4.5 Exceptions</span>
<a href=#exceptions class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>To handle errors in a controlled and consistent way, we define a custom exception system. For each resource in the application, a specific package is created containing two types of files:</p><ul><li><strong>Custom exception classes</strong>, one for each type of error that can occur in that resource.</li><li>A <strong>centralized exception handler</strong>, which catches the thrown exceptions and returns an HTTP response in JSON format to the client.</li></ul><p>An example of an exception class would be the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.Excepciones.Prestamos</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamoNotFoundException</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RuntimeException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>PrestamoNotFoundException</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>construirMensaje</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>isbn</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>construirMensaje</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w>  </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=s>&#34;No se pudo encontrar el prestamo con matricula &#34;</span><span class=o>+</span><span class=n>matricula</span><span class=o>+</span><span class=s>&#34; e isbn &#34;</span><span class=o>+</span><span class=n>isbn</span><span class=o>+</span><span class=s>&#34;.&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=s>&#34;No se pudo encontrar el prestamo con id &#34;</span><span class=o>+</span><span class=n>id</span><span class=o>+</span><span class=s>&#34;.&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>An exception is defined to be thrown when a loan is not found. The <code>construirMensaje</code> method allows us to construct the error message dynamically, depending on whether the resource ID was specified or not.</p><p>On the other hand, we have the exception handler file (in this case <code>PrestamosExcepciones.java</code>), annotated with <code>@RestControllerAdvice</code> to catch and handle exceptions related to loans and return an HTTP response in JSON format:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.Excepciones.Prestamos</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.Excepciones.ErrorMessage</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.ExceptionHandler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.ResponseStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.RestControllerAdvice</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestControllerAdvice</span><span class=c1>//Captura excepciones de toda la aplicación y devuelve JSON</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamosExcepciones</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoNotFoundContentException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoNotFoundContentException</span><span class=p>(</span><span class=n>PrestamoNotFoundContentException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>FechaDevolucionException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>FechaDevolucionException</span><span class=p>(</span><span class=n>FechaDevolucionException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoNotFoundException</span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoConflictException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoConflictException</span><span class=p>(</span><span class=n>PrestamoConflictException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoVerificadoException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoVerificadoException</span><span class=p>(</span><span class=n>PrestamoVerificadoException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>LibroNoDisponibleException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>LibroNoDisponibleException</span><span class=p>(</span><span class=n>LibroNoDisponibleException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>UsuarioDevolucionesPendientesException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>UsuarioDevolucionesPendientesException</span><span class=p>(</span><span class=n>UsuarioDevolucionesPendientesException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>UsuarioSancionadoException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>UsuarioSancionadoException</span><span class=p>(</span><span class=n>UsuarioSancionadoException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoDevueltoException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoDevueltoException</span><span class=p>(</span><span class=n>PrestamoDevueltoException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoFechaPrestamoNoCoincideException</span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoFechaDevolucionNoCoincideException</span><span class=p>(</span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>UsuarioNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>UsuarioNoCoincideException</span><span class=p>(</span><span class=n>UsuarioNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>LibroNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>LibroNoCoincideException</span><span class=p>(</span><span class=n>LibroNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>In each method of the handler:</p><ul><li>We indicate with the <code>@ExceptionHandler</code> annotation the class of the exception to be caught.</li><li>With the <code>@ResponseStatus</code> annotation, we specify the HTTP error code to be returned.</li><li>We return an <code>ErrorMessage</code> object containing the error message, which is returned in JSON format.</li></ul><hr><h2 class=heading-element id=client><span>5 Client</span>
<a href=#client class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>To create the client that will consume the RESTful API, we create a new <strong>Spring</strong> project. We structure the code into <em>two folders</em>:</p><ul><li><code>models</code>: contains the entities, their pageable versions, and some auxiliary classes like <code>href</code>, <code>ResourceLink</code>, and <code>Pagelinks</code>.</li><li><code>service</code>: defines the methods that perform operations on the RESTful API (<code>post</code>, <code>get</code>, <code>put</code>, <code>delete</code>).</li></ul><p>Outside of these folders, at the same level, there is the <code>ClienteApplication.java</code> file, which is the entry point of the client, and where we invoke the methods defined in <code>service</code>.</p><p>To begin, in the <code>models</code> folder we define the attributes of each class. For example, the <code>Prestamo</code> class would be the same as before, but with the addition of the <code>_links</code> attribute:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.annotation.JsonProperty</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Prestamo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Usuario</span><span class=w> </span><span class=n>usuario</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>devuelto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>verificar_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>ampliar</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JsonProperty</span><span class=p>(</span><span class=s>&#34;_links&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>ResourceLink</span><span class=w> </span><span class=n>_links</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>The <code>ResourceLink</code> class is composed of an <code>Href</code> object, which encapsulates a URL as a <code>string</code>. Regarding <code>Pagelinks</code>, it is a class that contains references for the paged navigation of results:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PageLinks</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>first</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>self</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>last</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Within the <code>service</code> folder, we have a single file <code>BibliotecaService.java</code> that implements the methods to interact with the different RESTful API endpoints.</p><blockquote><p>As in previous occasions, to facilitate reading I have included a representative snippet of the complete file.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Map</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.MediaType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatusCode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.reactive.function.client.WebClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.Libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.Prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.Usuario</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>reactor.core.publisher.Mono</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>BibliotecaService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebClient</span><span class=w> </span><span class=n>webClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WebClient</span><span class=p>.</span><span class=na>builder</span><span class=p>().</span><span class=na>baseUrl</span><span class=p>(</span><span class=s>&#34;http://localhost:8080/biblioteca.api&#34;</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getUsuario</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Usuario</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webClient</span><span class=p>.</span><span class=na>get</span><span class=p>().</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/users/{matricula}&#34;</span><span class=p>,</span><span class=n>matricula</span><span class=p>).</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is5xxServerError</span><span class=p>,</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 5xx&#34;</span><span class=o>+</span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>Usuario</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>selfLink</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>get_links</span><span class=p>().</span><span class=na>getFirstHref</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Usuario con matricula: &#34;</span><span class=o>+</span><span class=n>user</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=o>+</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34; y correo: &#34;</span><span class=o>+</span><span class=n>user</span><span class=p>.</span><span class=na>getCorreo</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; se encuentra disponible en el link: &#34;</span><span class=o>+</span><span class=w> </span><span class=n>selfLink</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Usuario no encontrado&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>postPrestamo</span><span class=p>(</span><span class=n>Usuario</span><span class=w> </span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>devuelto</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>verificarDevolucion</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>ampliar</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Prestamo</span><span class=w> </span><span class=n>prestamo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Prestamo</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setUsuario</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setLibro</span><span class=p>(</span><span class=n>libro</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setFecha_prestamo</span><span class=p>(</span><span class=n>fechaPrestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setFecha_devolucion</span><span class=p>(</span><span class=n>fechaDevolucion</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setDevuelto</span><span class=p>(</span><span class=n>devuelto</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setVerificar_devolucion</span><span class=p>(</span><span class=n>verificarDevolucion</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setAmpliar</span><span class=p>(</span><span class=n>ampliar</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>referencia</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webClient</span><span class=p>.</span><span class=na>post</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/prestamos&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>prestamo</span><span class=p>),</span><span class=w> </span><span class=n>Prestamo</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=o>+</span><span class=n>body</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>toBodilessEntity</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>getLocation</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>getLocation</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;No se recibió URL en la cabecera Location&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>referencia</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>referencia</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>partes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>referencia</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>partes</span><span class=o>[</span><span class=n>partes</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error: &#34;</span><span class=o>+</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>putLibro</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>titulo</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>autores</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>edicion</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>editorial</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>disponibles</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>unidades</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setIsbn</span><span class=p>(</span><span class=n>isbn</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setTitulo</span><span class=p>(</span><span class=n>titulo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setAutores</span><span class=p>(</span><span class=n>autores</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setEdicion</span><span class=p>(</span><span class=n>edicion</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setEditorial</span><span class=p>(</span><span class=n>editorial</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setDisponibles</span><span class=p>(</span><span class=n>disponibles</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setUnidades</span><span class=p>(</span><span class=n>unidades</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webClient</span><span class=p>.</span><span class=na>put</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/libros/{isbn}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>isbn</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>libro</span><span class=p>),</span><span class=n>Usuario</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is5xxServerError</span><span class=p>,</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 5xx&#34;</span><span class=o>+</span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>).</span><span class=na>toBodilessEntity</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteUsuario</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webClient</span><span class=p>.</span><span class=na>delete</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/users/{matricula}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>matricula</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>toBodilessEntity</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;El Usuario con matricula &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; ha sido eliminado.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>I have included the four CRUD operations to illustrate the different use cases. As can be seen, <code>webClient</code> is invoked with the operation to perform, the URI with its parameter is passed (if applicable), the request is sent using <code>retrieve()</code>, possible errors are handled with <code>onStatus()</code> and <code>doOnNext()</code>, and finally the response is processed with <code>bodyToMono()</code> or <code>toBodilessEntity()</code>, followed by <code>block()</code> to obtain the result synchronously.</p><p>Regarding <code>ClienteApplication.java</code>, it consists of a set of tests that are responsible for testing each method of the RESTful API. Here I show a snippet of the code from this file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.ArrayList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.SpringApplication</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.autoconfigure.SpringBootApplication</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.service.BibliotecaService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SpringBootApplication</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ClienteApplication</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=n>BibliotecaService</span><span class=w> </span><span class=n>servicio</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BibliotecaService</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;===== INICIO DEL TEST DE OPERACIONES =====&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SpringApplication</span><span class=p>.</span><span class=na>run</span><span class=p>(</span><span class=n>ClienteApplication</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] POST de Usuarios\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadir 2 usuarios&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>nombres</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;Ana&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Luis&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>correos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;correo1@correo.com&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;correo2@correo.com&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>2</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Usuario con matricula: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y nombre: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>nombres</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>aux</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>servicio</span><span class=p>.</span><span class=na>postUsuario</span><span class=p>(</span><span class=n>aux</span><span class=p>,</span><span class=w> </span><span class=n>nombres</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>correos</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1990-01-01&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>matricula</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] GET de Usuarios\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\t[-] GET de Usuario con matricula 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Usuario con matricula 2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>(</span><span class=s>&#34;2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] POST de libros\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadir cuatro libros&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>isbn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=s>&#34;2&#34;</span><span class=p>,</span><span class=s>&#34;3&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;4&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>titulos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;King pantera&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Amongus&#34;</span><span class=p>,</span><span class=s>&#34;Terrence McKenna&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pedro sanchez ~ final electrica&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>autores</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;King&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Miguel de Cervantes&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Abderraman III&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Kevin Roldan&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>ediciones</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>editoriales</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>4</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Libro con isbn: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>isbn</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y titulo: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>titulos</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>servicio</span><span class=p>.</span><span class=na>postLibro</span><span class=p>(</span><span class=n>isbn</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>titulos</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>ediciones</span><span class=p>,</span><span class=w> </span><span class=n>editoriales</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] GET de Libros\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Libros con isbn 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getLibro</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Libros con isbn 4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getLibro</span><span class=p>(</span><span class=s>&#34;4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Libros con filtrado por titulo =&gt; &#39;pedro&#39;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getPorTitulo</span><span class=p>(</span><span class=s>&#34;pedro&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET unidades del Libro con isbn 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Integer</span><span class=w> </span><span class=n>unidades</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>getLibroUnidades</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Unidades del libro con isbn 1: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>unidades</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] POST de prestamos\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamo1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Usuario</span><span class=w> </span><span class=n>user1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Usuario</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=s>&#34;Ana&#34;</span><span class=p>,</span><span class=s>&#34;correo1@correo.com&#34;</span><span class=p>,</span><span class=s>&#34;1990-01-01&#34;</span><span class=p>,</span><span class=kc>null</span><span class=p>,</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>prestamo1</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>titulos</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>(</span><span class=s>&#34;2&#34;</span><span class=p>,</span><span class=n>titulos</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>(</span><span class=s>&#34;3&#34;</span><span class=p>,</span><span class=n>titulos</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>ids</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>int</span><span class=o>[</span><span class=n>3</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Prestamo con usuario: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user1</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y libro: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>libro1</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ids</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>postPrestamo</span><span class=p>(</span><span class=n>user1</span><span class=p>,</span><span class=w> </span><span class=n>libro1</span><span class=p>,</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>,</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>.</span><span class=na>plusWeeks</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Prestamo con usuario: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user1</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y libro: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>libro2</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ids</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>postPrestamo</span><span class=p>(</span><span class=n>user1</span><span class=p>,</span><span class=w> </span><span class=n>libro2</span><span class=p>,</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>,</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>.</span><span class=na>plusWeeks</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Prestamo con usuario: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user1</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y libro: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>libro3</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ids</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>postPrestamo</span><span class=p>(</span><span class=n>user1</span><span class=p>,</span><span class=w> </span><span class=n>libro3</span><span class=p>,</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>.</span><span class=na>minusMonths</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>.</span><span class=na>minusMonths</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] GET de Prestamos\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getPrestamo</span><span class=p>(</span><span class=n>ids</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>As can be seen, the standard operations for creating and querying <strong>users</strong>, <strong>books</strong>, and <strong>loans</strong> are performed, thus covering the typical use cases of the application.</p><p>To see it in action, you can check the <a href=#usage-example>usage example</a> section.</p><hr><h2 class=heading-element id=usage><span>6 Usage</span>
<a href=#usage class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>To run the project, we use <code>Docker</code>. Since we have both a <code>Dockerfile</code> and a <code>docker-compose.yaml</code>, we can start the service with the following command:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up -d</span></span></code></pre></td></tr></table></div></div><p>(or without the <code>-d</code> flag). This will launch <em>two containers</em>:</p><ul><li>One for the application backend, accessible through port <code>8080</code>.</li><li>Another for the <code>PostgreSQL</code> database.</li></ul><p>To run the client, we have two options: either navigate to the client file and execute it directly, or use the <code>script.sh</code> located in the root directory of the repository. This script will start the service (if it’s not already running) and execute the client.</p><blockquote><p><strong>Note:</strong> Make sure you are in the root of the project for the script to work properly.</p></blockquote><h2 class=heading-element id=usage-example><span>7 Usage Example</span>
<a href=#usage-example class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>This section shows some examples of how to interact with the API, all extracted from the <a href=#client>client</a>. In my case I use <code>Postman</code>, but you can use any REST client.</p><blockquote><p>The client is executed using <strong>break points</strong> after each block of operations.</p></blockquote><p>We start the client execution:</p><p><a class=lightgallery href=/en/posts/sos/images/image.png title=Execution data-thumbnail=/en/posts/sos/images/image.png data-sub-html="<h2>Execution</h2>"><img loading=lazy src=/en/posts/sos/images/image.png alt=Execution height=605 width=1075></a></p><p>We create 2 users (POST):</p><p><a class=lightgallery href=/en/posts/sos/images/image1.png title="POST Users" data-thumbnail=/en/posts/sos/images/image1.png data-sub-html="<h2>POST Users</h2>"><img loading=lazy src=/en/posts/sos/images/image1.png alt="POST Users" height=577 width=1026></a></p><p>We do a GET for each of them:</p><p><a class=lightgallery href=/en/posts/sos/images/image2.png title="GET Users" data-thumbnail=/en/posts/sos/images/image2.png data-sub-html="<h2>GET Users</h2>"><img loading=lazy src=/en/posts/sos/images/image2.png alt="GET Users" height=460 width=502></a> <a class=lightgallery href=/en/posts/sos/images/image3.png title="GET Users" data-thumbnail=/en/posts/sos/images/image3.png data-sub-html="<h2>GET Users</h2>"><img loading=lazy src=/en/posts/sos/images/image3.png alt="GET Users" height=461 width=505></a></p><p>We create 3 books (POST):</p><p><a class=lightgallery href=/en/posts/sos/images/image4.png title="POST Books" data-thumbnail=/en/posts/sos/images/image4.png data-sub-html="<h2>POST Books</h2>"><img loading=lazy src=/en/posts/sos/images/image4.png alt="POST Books" height=578 width=1028></a></p><p>The first 3 books are shown (<code>page=0&amp;size=3</code>).</p><p>Next, the GET operations shown in the previous console output.</p><p>GET for the book with ISBN 1:</p><p><a class=lightgallery href=/en/posts/sos/images/image5.png title="GET Book 1" data-thumbnail=/en/posts/sos/images/image5.png data-sub-html="<h2>GET Book 1</h2>"><img loading=lazy src=/en/posts/sos/images/image5.png alt="GET Book 1" height=308 width=1075></a></p><p>GET for the book with ISBN 4:</p><p><a class=lightgallery href=/en/posts/sos/images/image6.png title="GET Book 4" data-thumbnail=/en/posts/sos/images/image6.png data-sub-html="<h2>GET Book 4</h2>"><img loading=lazy src=/en/posts/sos/images/image6.png alt="GET Book 4" height=311 width=1075></a></p><p>GET for book filtered by name:</p><p><a class=lightgallery href=/en/posts/sos/images/image7.png title="GET Filtered Book" data-thumbnail=/en/posts/sos/images/image7.png data-sub-html="<h2>GET Filtered Book</h2>"><img loading=lazy src=/en/posts/sos/images/image7.png alt="GET Filtered Book" height=449 width=1075></a></p><p>GET for the number of available units of the book with ISBN 1:</p><p><a class=lightgallery href=/en/posts/sos/images/image8.png title="GET Units" data-thumbnail=/en/posts/sos/images/image8.png data-sub-html="<h2>GET Units</h2>"><img loading=lazy src=/en/posts/sos/images/image8.png alt="GET Units" height=220 width=1075></a></p><p>We create 3 loans (POST):</p><p><a class=lightgallery href=/en/posts/sos/images/image9.png title="POST Loans" data-thumbnail=/en/posts/sos/images/image9.png data-sub-html="<h2>POST Loans</h2>"><img loading=lazy src=/en/posts/sos/images/image9.png alt="POST Loans" height=605 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image10.png title="Postman Loans" data-thumbnail=/en/posts/sos/images/image10.png data-sub-html="<h2>Postman Loans</h2>"><img loading=lazy src=/en/posts/sos/images/image10.png alt="Postman Loans" height=607 width=1075></a></p><p>GET for the loan with id=1:</p><p><a class=lightgallery href=/en/posts/sos/images/image11.png title="GET Loan 1" data-thumbnail=/en/posts/sos/images/image11.png data-sub-html="<h2>GET Loan 1</h2>"><img loading=lazy src=/en/posts/sos/images/image11.png alt="GET Loan 1" height=517 width=502></a></p><p>We update a user and a book (PUT):</p><p><a class=lightgallery href=/en/posts/sos/images/image12.png title="PUT User" data-thumbnail=/en/posts/sos/images/image12.png data-sub-html="<h2>PUT User</h2>"><img loading=lazy src=/en/posts/sos/images/image12.png alt="PUT User" height=137 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image13.png title=Console data-thumbnail=/en/posts/sos/images/image13.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image13.png alt=Console height=309 width=1075></a></p><p>We verify the user update in Postman:</p><p><a class=lightgallery href=/en/posts/sos/images/image14.png title=Postman data-thumbnail=/en/posts/sos/images/image14.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image14.png alt=Postman height=821 width=706></a></p><p>We verify the book update in Postman:</p><p><a class=lightgallery href=/en/posts/sos/images/image15.png title=Postman data-thumbnail=/en/posts/sos/images/image15.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image15.png alt=Postman height=262 width=1075></a></p><p>We delete the user with matriculation number 2:</p><p><a class=lightgallery href=/en/posts/sos/images/image16.png title="DELETE User" data-thumbnail=/en/posts/sos/images/image16.png data-sub-html="<h2>DELETE User</h2>"><img loading=lazy src=/en/posts/sos/images/image16.png alt="DELETE User" height=194 width=1002></a>
<a class=lightgallery href=/en/posts/sos/images/image17.png title=Console data-thumbnail=/en/posts/sos/images/image17.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image17.png alt=Console height=195 width=467></a></p><p>We verify the existence of user 2:</p><p><a class=lightgallery href=/en/posts/sos/images/image18.png title=Postman data-thumbnail=/en/posts/sos/images/image18.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image18.png alt=Postman height=836 width=701></a></p><p>We run all possible GET operations:</p><p><a class=lightgallery href=/en/posts/sos/images/image19.png title=GET data-thumbnail=/en/posts/sos/images/image19.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/en/posts/sos/images/image19.png alt=GET height=605 width=1075></a></p><p>We verify the GET for users — in this case, there&rsquo;s only one left:</p><p><a class=lightgallery href=/en/posts/sos/images/image20.png title=GET data-thumbnail=/en/posts/sos/images/image20.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/en/posts/sos/images/image20.png alt=GET height=565 width=1007></a></p><p>We verify the GET for books:</p><p><a class=lightgallery href=/en/posts/sos/images/image21.png title=GET data-thumbnail=/en/posts/sos/images/image21.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/en/posts/sos/images/image21.png alt=GET height=561 width=997></a></p><p>We verify the GET for loans:</p><p><a class=lightgallery href=/en/posts/sos/images/image22.png title=GET data-thumbnail=/en/posts/sos/images/image22.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/en/posts/sos/images/image22.png alt=GET height=547 width=976></a></p><p>We verify the GET for loans of a user:</p><p><a class=lightgallery href=/en/posts/sos/images/image23.png title=GET data-thumbnail=/en/posts/sos/images/image23.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/en/posts/sos/images/image23.png alt=GET height=554 width=985></a></p><p>Now we perform all possible PUT operations on loans: extending a loan, returning a loan, and verifying a return.</p><p>Extend a loan (PUT):</p><p><a class=lightgallery href=/en/posts/sos/images/image24.png title="PUT Loan" data-thumbnail=/en/posts/sos/images/image24.png data-sub-html="<h2>PUT Loan</h2>"><img loading=lazy src=/en/posts/sos/images/image24.png alt="PUT Loan" height=108 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image25.png title=Console data-thumbnail=/en/posts/sos/images/image25.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image25.png alt=Console height=69 width=1075></a></p><p>We verify that the return date was correctly extended.
The original return date was <code>LocalDate.now().plusWeeks(1)</code>. Since today is <strong>25/06</strong>, the initial date was <strong>02/07</strong>. After the extension (two additional weeks), the new return date should be <strong>16/07</strong>.</p><p><a class=lightgallery href=/en/posts/sos/images/image26.png title=Postman data-thumbnail=/en/posts/sos/images/image26.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image26.png alt=Postman height=653 width=541></a></p><p>Now we try 2 error cases:</p><p><a class=lightgallery href=/en/posts/sos/images/image27.png title="Error Cases" data-thumbnail=/en/posts/sos/images/image27.png data-sub-html="<h2>Error Cases</h2>"><img loading=lazy src=/en/posts/sos/images/image27.png alt="Error Cases" height=105 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image28.png title=Console data-thumbnail=/en/posts/sos/images/image28.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image28.png alt=Console height=193 width=1075></a></p><p>As seen, the appropriate errors are thrown. Testing in Postman shows the same:</p><p><a class=lightgallery href=/en/posts/sos/images/image29.png title=Postman data-thumbnail=/en/posts/sos/images/image29.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image29.png alt=Postman height=424 width=502></a> <a class=lightgallery href=/en/posts/sos/images/image30.png title=Postman data-thumbnail=/en/posts/sos/images/image30.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image30.png alt=Postman height=426 width=545></a></p><p>Return a loan (PUT):</p><p><a class=lightgallery href=/en/posts/sos/images/image31.png title=PUT data-thumbnail=/en/posts/sos/images/image31.png data-sub-html="<h2>PUT</h2>"><img loading=lazy src=/en/posts/sos/images/image31.png alt=PUT height=89 width=1075></a></p><p>Verification:</p><p><a class=lightgallery href=/en/posts/sos/images/image32.png title=Postman data-thumbnail=/en/posts/sos/images/image32.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image32.png alt=Postman height=555 width=615></a></p><p>Now we try 3 more error cases:</p><p><a class=lightgallery href=/en/posts/sos/images/image33.png title="Error Cases" data-thumbnail=/en/posts/sos/images/image33.png data-sub-html="<h2>Error Cases</h2>"><img loading=lazy src=/en/posts/sos/images/image33.png alt="Error Cases" height=154 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image34.png title=Console data-thumbnail=/en/posts/sos/images/image34.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image34.png alt=Console height=114 width=1075></a></p><p>Again, all errors are triggered. We check in Postman:</p><ul><li><strong>409 Conflict</strong>: already returned.</li></ul><p><a class=lightgallery href=/en/posts/sos/images/image35.png title=Postman data-thumbnail=/en/posts/sos/images/image35.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image35.png alt=Postman height=799 width=656></a></p><ul><li><strong>400 Bad Request</strong>: loan ID 1 has a different book than the one sent — actual ISBN is 1, sent ISBN is 3.</li></ul><p><a class=lightgallery href=/en/posts/sos/images/image36.png title=Postman data-thumbnail=/en/posts/sos/images/image36.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image36.png alt=Postman height=644 width=525></a></p><ul><li><strong>404 Not Found</strong>: loan with ID 3 not found.</li></ul><p><a class=lightgallery href=/en/posts/sos/images/image37.png title=Postman data-thumbnail=/en/posts/sos/images/image37.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image37.png alt=Postman height=637 width=531></a></p><p>Verify a return (PUT):</p><p><a class=lightgallery href=/en/posts/sos/images/image38.png title=PUT data-thumbnail=/en/posts/sos/images/image38.png data-sub-html="<h2>PUT</h2>"><img loading=lazy src=/en/posts/sos/images/image38.png alt=PUT height=62 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image39.png title=Console data-thumbnail=/en/posts/sos/images/image39.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image39.png alt=Console height=182 width=1075></a></p><p>Verification:</p><p><a class=lightgallery href=/en/posts/sos/images/image40.png title=Postman data-thumbnail=/en/posts/sos/images/image40.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image40.png alt=Postman height=461 width=512></a></p><p>Since it was an overdue and unreturned loan, the number of pending returns for the user increases:</p><p><a class=lightgallery href=/en/posts/sos/images/image41.png title=Postman data-thumbnail=/en/posts/sos/images/image41.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image41.png alt=Postman height=369 width=513></a></p><p>Indeed, it increased. If the user returns it now, the pending count drops to 0 and a penalty is applied.</p><p>We perform 3 incorrect return verifications:</p><p><a class=lightgallery href=/en/posts/sos/images/image42.png title="Error Cases" data-thumbnail=/en/posts/sos/images/image42.png data-sub-html="<h2>Error Cases</h2>"><img loading=lazy src=/en/posts/sos/images/image42.png alt="Error Cases" height=153 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image43.png title=Console data-thumbnail=/en/posts/sos/images/image43.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image43.png alt=Console height=118 width=1075></a></p><p>All three errors appear. In Postman:</p><ul><li><strong>409 Conflict</strong>: loan ID 3 cannot be verified — already verified, already returned, or not yet overdue.</li></ul><p><a class=lightgallery href=/en/posts/sos/images/image44.png title=Postman data-thumbnail=/en/posts/sos/images/image44.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image44.png alt=Postman height=770 width=623></a></p><ul><li><strong>400 Bad Request</strong>: loan ID 3 has a different loan date — expected 2025-05-25, sent 2025-05-20.</li></ul><p><a class=lightgallery href=/en/posts/sos/images/image45.png title=Postman data-thumbnail=/en/posts/sos/images/image45.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image45.png alt=Postman height=616 width=508></a></p><ul><li><strong>404 Not Found</strong>: loan ID 4 not found.</li></ul><p><a class=lightgallery href=/en/posts/sos/images/image46.png title=Postman data-thumbnail=/en/posts/sos/images/image46.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image46.png alt=Postman height=620 width=509></a></p><p>Now we try to request a loan with a user that has pending returns, and then again after returns.</p><p><a class=lightgallery href=/en/posts/sos/images/image47.png title="POST Loans" data-thumbnail=/en/posts/sos/images/image47.png data-sub-html="<h2>POST Loans</h2>"><img loading=lazy src=/en/posts/sos/images/image47.png alt="POST Loans" height=124 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image48.png title=Console data-thumbnail=/en/posts/sos/images/image48.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image48.png alt=Console height=236 width=1075></a></p><p>Both fail as expected. In Postman:</p><p><a class=lightgallery href=/en/posts/sos/images/image49.png title=Postman data-thumbnail=/en/posts/sos/images/image49.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image49.png alt=Postman height=390 width=482></a> <a class=lightgallery href=/en/posts/sos/images/image50.png title=Postman data-thumbnail=/en/posts/sos/images/image50.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image50.png alt=Postman height=323 width=484></a></p><p>To finish, we test different GET methods:</p><p><a class=lightgallery href=/en/posts/sos/images/image51.png title=GET data-thumbnail=/en/posts/sos/images/image51.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/en/posts/sos/images/image51.png alt=GET height=633 width=1075></a>
<a class=lightgallery href=/en/posts/sos/images/image52.png title=Console data-thumbnail=/en/posts/sos/images/image52.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image52.png alt=Console height=508 width=1075></a></p><p>Verifying in the same order as the console and code:</p><p><a class=lightgallery href=/en/posts/sos/images/image53.png title=Postman data-thumbnail=/en/posts/sos/images/image53.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image53.png alt=Postman height=568 width=1009></a>
<a class=lightgallery href=/en/posts/sos/images/image54.png title=Postman data-thumbnail=/en/posts/sos/images/image54.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image54.png alt=Postman height=164 width=1009></a>
<a class=lightgallery href=/en/posts/sos/images/image55.png title=Postman data-thumbnail=/en/posts/sos/images/image55.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image55.png alt=Postman height=568 width=1011></a>
<a class=lightgallery href=/en/posts/sos/images/image56.png title=Postman data-thumbnail=/en/posts/sos/images/image56.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image56.png alt=Postman height=523 width=937></a></p><p>Returned:</p><p><a class=lightgallery href=/en/posts/sos/images/image57.png title=Postman data-thumbnail=/en/posts/sos/images/image57.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image57.png alt=Postman height=603 width=1075></a></p><p>Activity:</p><p><a class=lightgallery href=/en/posts/sos/images/image58.png title=Postman data-thumbnail=/en/posts/sos/images/image58.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image58.png alt=Postman height=613 width=1075></a></p><p>Delete loans (DELETE):</p><p><a class=lightgallery href=/en/posts/sos/images/image59.png title=DELETE data-thumbnail=/en/posts/sos/images/image59.png data-sub-html="<h2>DELETE</h2>"><img loading=lazy src=/en/posts/sos/images/image59.png alt=DELETE height=173 width=738></a>
<a class=lightgallery href=/en/posts/sos/images/image60.png title=Console data-thumbnail=/en/posts/sos/images/image60.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image60.png alt=Console height=200 width=547></a>
<a class=lightgallery href=/en/posts/sos/images/image61.png title=Postman data-thumbnail=/en/posts/sos/images/image61.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image61.png alt=Postman height=255 width=1075></a></p><p>Delete books (DELETE):</p><p><a class=lightgallery href=/en/posts/sos/images/image62.png title=DELETE data-thumbnail=/en/posts/sos/images/image62.png data-sub-html="<h2>DELETE</h2>"><img loading=lazy src=/en/posts/sos/images/image62.png alt=DELETE height=220 width=736></a>
<a class=lightgallery href=/en/posts/sos/images/image63.png title=Console data-thumbnail=/en/posts/sos/images/image63.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image63.png alt=Console height=201 width=434></a>
<a class=lightgallery href=/en/posts/sos/images/image64.png title=Postman data-thumbnail=/en/posts/sos/images/image64.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image64.png alt=Postman height=254 width=1075></a></p><p>Delete users (DELETE):</p><p><a class=lightgallery href=/en/posts/sos/images/image65.png title=DELETE data-thumbnail=/en/posts/sos/images/image65.png data-sub-html="<h2>DELETE</h2>"><img loading=lazy src=/en/posts/sos/images/image65.png alt=DELETE height=164 width=714></a>
<a class=lightgallery href=/en/posts/sos/images/image66.png title=Console data-thumbnail=/en/posts/sos/images/image66.png data-sub-html="<h2>Console</h2>"><img loading=lazy src=/en/posts/sos/images/image66.png alt=Console height=314 width=1042></a>
<a class=lightgallery href=/en/posts/sos/images/image67.png title=Postman data-thumbnail=/en/posts/sos/images/image67.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/en/posts/sos/images/image67.png alt=Postman height=252 width=1075></a></p><p>And that concludes the client.</p><h2 class=heading-element id=conclusion><span>8 Conclusion</span>
<a href=#conclusion class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>This project is a good example of how to create a RESTful API using <em>Spring Boot</em>. It is quite complete, as it covers various aspects such as architecture, the use of REST patterns, centralized exception handling, and the creation of a client to consume the API.</p><p>As always, you can find the source code in my <a href=https://github.com/azuar4e/RESTful-Service target=_blank rel="external nofollow noopener noreferrer">GitHub repository</a>.</p><p>Have a nice life! 👋</p></div><hr class=awesome-hr><h2 id=see-also>Related Content</h2><ul><li><a href=/en/posts/tdl/ title="Language Translator">Language Translator</a></li></ul><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2025-06-17 12:30:24">Updated on 2025-06-17&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/en/posts/sos/index.md title="Read Markdown" class=link-to-markdown>Read Markdown</a></span><span><a href="https://github.com/azuar4e/azuar4e.github.io/blob/main/content/posts/university/sos/index.md?plain=1" title="View source" target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>View source</a></span><span><a href=https://github.com/azuar4e/azuar4e.github.io/edit/main/content/posts/university/sos/index.md title="Edit this page" target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>Edit this page</a></span><span><a href="https://github.com/azuar4e/azuar4e.github.io/issues/new?title=[BUG]%20RESTful+Service&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cRESTful+Service%7c%0A%7cURL%7chttps://azuar4e.github.io/en/posts/sos/%7c%0A%7cFilename%7chttps://github.com/azuar4e/azuar4e.github.io/blob/main/content/posts/university/sos/index.md?plain=1%7c" title="Report issue" target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>Report issue</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=twitter data-url=https://azuar4e.github.io/en/posts/sos/ data-title="RESTful Service" data-via=azuar4e data-hashtags=Java,Spring,API><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://azuar4e.github.io/en/posts/sos/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://azuar4e.github.io/en/posts/sos/ data-title="RESTful Service" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://azuar4e.github.io/en/posts/sos/><i class="fa-brands fa-reddit fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/en/tags/java/ class=post-tag title="Tags - Java">Java</a><a href=/en/tags/spring/ class=post-tag title="Tags - Spring">Spring</a><a href=/en/tags/api/ class=post-tag title="Tags - API">API</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/en/>Home</a></span></section></div><div class=post-nav><a href=/en/posts/tdl/ class=post-nav-item rel=next title="Language Translator">Language Translator<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article><aside class=toc id=toc-auto aria-label=Contents><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.147.8"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Theme - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.21-b2e6f70a"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2025</span><span class=author itemprop=copyrightHolder>
<a href=https://www.linkedin.com/in/angel-azuara/ target=_blank rel="external nofollow noopener noreferrer">Angel Azuara Eizaguirre</a></span></div><div class="footer-line statistics order-3"><span class=site-time title='Website running ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">Website running ...</span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/azuar4e/azuar4e.github.io title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#8581dd;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>This website works best with JavaScript enabled.</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{enable:!1},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,search:{algoliaAppID:"L5YIFQ7E5O",algoliaIndex:"miblog_algolia_en",algoliaSearchKey:"4730818b3e23ce341fdbb2edbce34eda",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:50,type:"algolia"},siteTime:"2025-06-20T00:00:00+02:00",version:"v0.3.21-b2e6f70a"}</script><script src=/js/theme.min.js defer></script></body></html>
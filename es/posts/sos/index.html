<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=es><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Servicio RESTful - azuar4e</title><meta name=author content="Angel Azuara Eizaguirre"><meta name=description content="Un proyecto universitario de la asignatura Sistemas Orientados a Servicios."><meta name=keywords content='Java,Spring,API'><meta itemprop=name content="Servicio RESTful"><meta itemprop=description content="Un proyecto universitario de la asignatura Sistemas Orientados a Servicios."><meta itemprop=datePublished content="2025-07-25T15:00:00+02:00"><meta itemprop=dateModified content="2025-07-25T15:00:00+02:00"><meta itemprop=wordCount content="4690"><meta itemprop=keywords content="Java,Spring,API"><meta property="og:url" content="https://azuar4e.github.io/es/posts/sos/"><meta property="og:site_name" content="azuar4e"><meta property="og:title" content="Servicio RESTful"><meta property="og:description" content="Un proyecto universitario de la asignatura Sistemas Orientados a Servicios."><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-25T15:00:00+02:00"><meta property="article:modified_time" content="2025-07-25T15:00:00+02:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="Spring"><meta property="article:tag" content="API"><meta name=twitter:card content="summary"><meta name=twitter:title content="Servicio RESTful"><meta name=twitter:description content="Un proyecto universitario de la asignatura Sistemas Orientados a Servicios."><meta name=twitter:site content="@azuar4e"><meta name=twitter:creator content="@azuar4e"><meta name=application-name content="azuar4e"><meta name=apple-mobile-web-app-title content="azuar4e"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical type=text/html href=https://azuar4e.github.io/es/posts/sos/ title="Servicio RESTful - azuar4e"><link rel=prev type=text/html href=https://azuar4e.github.io/es/posts/tdl/ title="Traductor de Lenguajes"><link rel=alternate type=text/markdown href=https://azuar4e.github.io/es/posts/sos/index.md title="Servicio RESTful - azuar4e"><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Servicio RESTful","inLanguage":"es","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/azuar4e.github.io\/es\/posts\/sos\/"},"genre":"posts","keywords":"Java, Spring, API","wordcount":4690,"url":"https:\/\/azuar4e.github.io\/es\/posts\/sos\/","datePublished":"2025-07-25T15:00:00+02:00","dateModified":"2025-07-25T15:00:00+02:00","publisher":{"@type":"Organization","name":"azuar4e","logo":"https:\/\/azuar4e.github.io\/images\/avatar.jpg"},"author":{"@type":"Person","name":"Angel Azuara Eizaguirre"},"description":"Un proyecto universitario de la asignatura Sistemas Orientados a Servicios."}</script><script src=/js/head/color-scheme.min.js></script></head><body data-header-desktop=sticky data-header-mobile=auto><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=/es/ title=azuar4e><span class=header-title-text>azuar4e</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/es/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archivos</a></li><li class=menu-item><a class=menu-link href=/es/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categorías</a></li><li class=menu-item><a class=menu-link href=/es/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Etiquetas</a></li><li class=menu-item><a class=menu-link href=/es/about/><i class="fa-solid fa-quote-left fa-fw fa-sm" aria-hidden=true></i> Acerca de</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Busca títulos o contenido..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Buscar><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Limpiar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Cambia el tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label="Selecciona el lenguage" title="Selecciona el lenguage"><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a href=/en/posts/sos/ class=menu-link title=English>English</a></li><li class=menu-item><span class=text-secondary title=Español>Español</span></li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/es/ title=azuar4e><span class=header-title-text>azuar4e</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Busca títulos o contenido..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Buscar><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Limpiar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancelar</a></li><li class=menu-item><a class=menu-link href=/es/archives/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> Archivos</a></li><li class=menu-item><a class=menu-link href=/es/categories/><i class="fa-solid fa-folder-tree fa-fw fa-sm" aria-hidden=true></i> Categorías</a></li><li class=menu-item><a class=menu-link href=/es/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Etiquetas</a></li><li class=menu-item><a class=menu-link href=/es/about/><i class="fa-solid fa-quote-left fa-fw fa-sm" aria-hidden=true></i> Acerca de</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Cambia el tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label="Selecciona el lenguage" title="Selecciona el lenguage">Español<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option value=/en/posts/sos/>English</option><option value=/es/posts/sos/ selected disabled>Español</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><nav aria-label=breadcrumb class="breadcrumb-container sticky"><ol class=breadcrumb><li class=breadcrumb-item data-separator=/><a href=/es/posts/ title=Posts>Artículos</a></li><li class="breadcrumb-item active" data-separator=/ aria-current=page>Servicio RESTful</li></ol></nav><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=Colecciones><div class="details related-details open"><div class="details-summary related-summary"><i class="fa-solid fa-fire fa-fade text-danger fa-fw" aria-hidden=true></i>
<span class=related-title>Contenido relacionado</span><i class="details-icon fa-solid fa-angle-right fa-fw" aria-hidden=true></i></div><div class="details-content related-content"><ul class=related-list><li class=related-item><a href=/es/posts/tdl/ title="Traductor De Lenguajes">Traductor De Lenguajes</a></li></ul></div></div></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Servicio RESTful</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://www.linkedin.com/in/angel-azuara/ title=Autor target=_blank rel="external nofollow noopener noreferrer author" class=author><img class=avatar src=/images/avatar.jpg alt="Angel Azuara Eizaguirre" height=16 width=16>&nbsp;Angel Azuara Eizaguirre</a></span><span class=post-included-in>&nbsp;incluido en <a href=/es/categories/universidad/ class=post-category title="Categoría - Universidad"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Universidad</a>&ensp;<a href=/es/categories/proyectos-personales/ class=post-category title="Categoría - Proyectos Personales"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Proyectos Personales</a></span></div><div class=post-meta-line><span title="publicado el 2025-07-25 15:00:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2025-07-25>2025-07-25</time></span>&nbsp;<span title="4690 palabras"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>Aproximadamente 4700 palabras</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>23 minutos</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contenido</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ol><li><a href=#introducción>Introducción</a></li><li><a href=#vista-general>Vista general</a></li><li><a href=#diseño-de-la-api>Diseño de la API</a><ol><li><a href=#-libros>📚 Libros</a></li><li><a href=#-préstamos>📄 Préstamos</a></li><li><a href=#-usuarios>👤 Usuarios</a></li></ol></li><li><a href=#arquitectura>Arquitectura</a><ol><li><a href=#modelos>Modelos</a></li><li><a href=#repositorios>Repositorios</a></li><li><a href=#servicios>Servicios</a></li><li><a href=#controladores>Controladores</a></li><li><a href=#excepciones>Excepciones</a></li></ol></li><li><a href=#cliente>Cliente</a></li><li><a href=#uso>Uso</a></li><li><a href=#ejemplo-de-uso>Ejemplo de uso</a></li><li><a href=#conclusión>Conclusión</a></li></ol></nav></div></div><div class=content id=content><h2 class=heading-element id=introducción><span>1 Introducción</span>
<a href=#introducci%c3%b3n class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>En este artículo explico una implementación de una REST API para el manejo de una biblioteca de libros. Esta implementación está escrita en <em>Java</em> y utiliza el Framework <em>Spring</em>. El proyecto pertenece a la asignatura <strong>Sistemas Orientados a Servicios</strong> del grado en <strong>Ingeniería Informática</strong>. Todo el código fuente está disponible en mi <a href=https://github.com/azuar4e/RESTful-Service target=_blank rel="external nofollow noopener noreferrer">repositorio de GitHub</a>.</p><hr><h2 class=heading-element id=vista-general><span>2 Vista general</span>
<a href=#vista-general class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>El servicio RESTful nos permite gestionar <strong>préstamos de libros</strong> en una biblioteca. Para ello usamos <strong>tres entidades</strong> principales: libros, usuarios y préstamos. En la siguiente imagen vemos el <strong>modelo Entidad-Relación</strong> utilizado:</p><p><a class=lightgallery href=/es/posts/sos/images/er-model.png title="Modelo ER" data-thumbnail=/es/posts/sos/images/er-model.png data-sub-html="<h2>Modelo ER</h2>"><img loading=lazy src=/es/posts/sos/images/er-model.png alt="Modelo ER" height=271 width=761></a></p><blockquote><p><strong>Nota:</strong> la relacion <code>libros-prestamos</code> se supone que es una relación de <code>1-1</code>, pero en nuestra implementación es una <code>1-n</code> ya que se permiten múltiples préstamos por libro mientras que este esté disponible.</p></blockquote><h2 class=heading-element id=diseño-de-la-api><span>3 Diseño de la API</span>
<a href=#dise%c3%b1o-de-la-api class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>La URL raíz de la aplicación es <code>http://localhost:8080/biblioteca.api/</code>.</p><p>La API expone tres recursos:</p><ul><li><code>/libros</code></li><li><code>/users</code></li><li><code>/prestamos</code></li></ul><p>Cada uno permite operaciones CRUD completas (<code>Create</code>, <code>Read</code>, <code>Update</code>, <code>Delete</code>), utilizando los métodos HTTP estándar (<code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>).</p><p>Los siguientes <strong>endpoints</strong> están disponibles:</p><h3 class=heading-element id=-libros><span>3.1 📚 Libros</span>
<a href=#-libros class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><code>GET /libros</code></li><li><code>GET /libros/{isbn}</code></li><li><code>GET /libros/{isbn}/unidades</code> – Número de copias disponibles</li><li><code>GET /libros?titulo_contiene={titulo}</code> – Búsqueda por título</li><li><code>GET /libros?disponible={true|false}</code> – Búsqueda por disponibilidad</li><li><code>POST /libros</code></li><li><code>PUT /libros/{isbn}</code></li><li><code>DELETE /libros/{isbn}</code></li></ul><hr><h3 class=heading-element id=-préstamos><span>3.2 📄 Préstamos</span>
<a href=#-pr%c3%a9stamos class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><code>GET /prestamos</code></li><li><code>GET /prestamos/{id}</code></li><li><code>POST /prestamos</code></li><li><code>PUT /prestamos/{id}</code> – Devolver libro o verificar préstamo (establece el atributo <code>devuelto</code> en <code>true</code> o <code>verificar_devolucion</code> en <code>true</code>)</li><li><code>DELETE /prestamos/{id}</code></li></ul><hr><h3 class=heading-element id=-usuarios><span>3.3 👤 Usuarios</span>
<a href=#-usuarios class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><ul><li><code>GET /users</code></li><li><code>GET /users/{matricula}</code> – ID del estudiante</li><li><code>GET /users/{matricula}/prestamos</code> – Préstamos del estudiante</li><li><code>PUT /users/{matricula}/prestamos/{id}</code> – Ampliar préstamo (establece el atributo <code>ampliar</code> en <code>true</code>)</li><li><code>GET /users/{matricula}/actividad</code> – Actividad del estudiante</li><li><code>POST /users</code></li><li><code>PUT /users/{matricula}</code></li><li><code>DELETE /users/{matricula}</code></li></ul><hr><h2 class=heading-element id=arquitectura><span>4 Arquitectura</span>
<a href=#arquitectura class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>El proyecto sigue el patrón <strong>Controller-Service-Repository</strong>, con la siguiente estructura:</p><ul><li><strong>Modelo:</strong> Representa la información de la base de datos mediante entidades, relaciones y atributos (las tablas).</li><li><strong>Repositorio:</strong> Se encarga de interactuar directamente con la base de datos.</li><li><strong>Servicio:</strong> Contiene la lógica de la aplicación y se comunica con el repositorio para procesar datos.</li><li><strong>Controlador:</strong> Gestiona las peticiones y respuestas HTTP, conectando al cliente con la lógica del servicio.</li></ul><p>Como podemos ver en la siguiente imagen, esa es la estructura del proyecto:</p><p><a class=lightgallery href=/es/posts/sos/images/arquitectura.png title=Arquitectura data-thumbnail=/es/posts/sos/images/arquitectura.png data-sub-html="<h2>Arquitectura</h2>"><img loading=lazy src=/es/posts/sos/images/arquitectura.png alt=Arquitectura height=571 width=1224></a></p><p>En la carpeta <strong>Excepciones</strong> se declaran todos los tipos de error para cada recurso con el correspondiente código de error HTTP.</p><blockquote><p>Todo el código que se muestre a continuación será relativo a los <em>préstamos</em> ya que es la entidad que relaciona libros y usuarios y por tanto es la más representativa del funcionamiento general de la API.</p></blockquote><h3 class=heading-element id=modelos><span>4.1 Modelos</span>
<a href=#modelos class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Lo primero es definir las entidades que componen la base de datos. Para ello dentro de la carpeta <strong>models</strong> declaramos dos clases para cada entidad:</p><ul><li>Una en la que definimos la tabla y los atributos que la componen.</li><li>Otra con el <code>ModelAssembler</code> que nos permite añadir enlaces <code>HATEOAS</code> a los recursos.</li></ul><p>A continuación se muestra el modelo de la entidad <code>Prestamo</code>, en el cual hacemos uso de:</p><ul><li><strong>Lombok</strong> (<code>@Data</code>, <code>@NoArgsConstructor</code>, <code>@AllArgsConstructor</code>) para generar automáticamente getters, setters y constructores.</li><li><strong>JPA</strong> (<code>@Entity</code>, <code>@Table</code>, <code>@Id</code>, etc.) para mapear la clase a una tabla en la base de datos.</li><li><strong>Spring HATEOAS</strong> (<code>extends RepresentationModel&lt;Prestamo></code>) para añadir enlaces HATEOAS a los recursos con el <code>ModelAssembler</code>.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.hateoas.RepresentationModel</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.annotation.JsonBackReference</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.persistence.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Prestamo&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Prestamo</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RepresentationModel</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>IDENTITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;usuario_id&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JsonBackReference</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Usuario</span><span class=w> </span><span class=n>usuario</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;libro_id&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;fecha_prestamo&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;fecha_devolucion&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>columnDefinition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;boolean default false&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>devuelto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>columnDefinition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;boolean default false&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>verificar_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;ampliar&#34;</span><span class=p>,</span><span class=w> </span><span class=n>columnDefinition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;boolean default false&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>ampliar</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p><code>@Id</code> es el identificador de la entidad, y lo autogeneramos mediante <code>@GeneratedValue</code>.</p><p><code>usuario</code> y <code>libro</code> representan relaciones <em>ManyToOne</em> con sus respectivas entidades.</p><ul><li>En el caso del usuario usamos <code>@JsonBackReference</code> para evitar serializaciones cíclicas. Esto es porque en el <strong>modelo</strong> de <code>Usuario</code> hay un atributo llamado <code>prestamos</code> que apunta a los préstamos del usuario; en ese atributo usamos <code>@JsonManagedReference</code>. El que tiene el managed reference es el que muestra la información en los JSON devueltos, es decir, que cuando se devuelve un usuario se muestra la información de sus préstamos, pero cuando se devuelve un prestamo no se muestra la información del usuario.</li></ul><p>Para el resto de atributos, usamos <code>@Column</code> para indicar que es un atributo de la tabla correspondiente y definimos si pueden ser nulos, si toman valores por defecto, etc.</p><p>En cuanto al <code>ModelAssembler</code> lo definimos como sigue:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.RepresentationModelAssemblerSupport</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Component</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.controllers.PrestamosController</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamoModelAssembler</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RepresentationModelAssemblerSupport</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=p>,</span><span class=w> </span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>PrestamoModelAssembler</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>PrestamosController</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>Prestamo</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Prestamo</span><span class=w> </span><span class=nf>toModel</span><span class=p>(</span><span class=n>Prestamo</span><span class=w> </span><span class=n>entity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>entity</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>linkTo</span><span class=p>(</span><span class=n>methodOn</span><span class=p>(</span><span class=n>PrestamosController</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getPrestamo</span><span class=p>(</span><span class=n>entity</span><span class=p>.</span><span class=na>getId</span><span class=p>())).</span><span class=na>withSelfRel</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>entity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>En el método <code>toModel</code> se añade un enlace a sí mismo (<code>self</code>) usando <code>linkTo</code> y <code>methodOn</code> apuntando al método del controlador que devuelve un préstamo por su identificador (<code>getPrestamo(id)</code>).</p><p>Esto nos permite que al devolver un objeto <code>Prestamo</code>, el JSON incluya un enlace tal que:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;_links&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;self&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;href&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:8080/biblioteca.api/prestamos/1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><h3 class=heading-element id=repositorios><span>4.2 Repositorios</span>
<a href=#repositorios class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>A continuación definimos los repositorios correspondientes a cada entidad. Como bien hemos dicho antes, estos se encargan de interactuar directamente con la base de datos.</p><p>Para los repositorios hacemos uso de:</p><ul><li><strong>JPA</strong>: Usamos anotaciones como <code>@Repository</code> y <code>@Query</code>, y extendemos <code>JpaRepository&lt;Prestamo, Integer></code> para obtener acceso a los métodos de persistencia más comunes (como <code>save</code>, <code>findAll</code>, <code>findById</code>, etc.), además de poder definir consultas personalizadas.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.repository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models.Libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.models.Prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Optional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.domain.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.jpa.repository.JpaRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.jpa.repository.Query</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.repository.query.Param</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Repository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>PrestamosRepository</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JpaRepository</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findById</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>findByUsuarioMatriculaAndDevueltoFalse</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;matricula&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;SELECT p FROM Prestamo p WHERE p.usuario.matricula = :matricula AND p.devuelto = false AND p.fecha_devolucion &gt; CURRENT_DATE ORDER BY p.fecha_prestamo DESC&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPrestamosActuales</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;matricula&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>paginable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Query</span><span class=p>(</span><span class=s>&#34;SELECT p FROM Prestamo p WHERE p.usuario.matricula = :matricula AND p.devuelto = true ORDER BY p.fecha_devolucion DESC&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getUltimosLibrosDevueltos</span><span class=p>(</span><span class=nd>@Param</span><span class=p>(</span><span class=s>&#34;matricula&#34;</span><span class=p>)</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>Pageable</span><span class=w> </span><span class=n>pageable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Prestamo</span><span class=w> </span><span class=nf>findByLibroIsbn</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Los métodos de persistencia mencionados anteriormente no requieren de ninguna consulta SQL ni JPQL explícita: Spring Data los infiere automáticamente a partir del nombre del método. El resto de métodos son consultas personalizadas.</p><ul><li><code>getPrestamosActuales</code> nos devuelve los préstamos de un usuario que aun no han sido devueltos y cuya fecha de devolución aun no ha pasado, ordenados por fecha de préstamo descendente.</li><li><code>getUltimosLibrosDevueltos</code> nos devuelve los últimos libros devueltos por un usuario, ordenados por fecha de devolución descendente.</li></ul><h3 class=heading-element id=servicios><span>4.3 Servicios</span>
<a href=#servicios class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Seguidamente se describen los servicios que componen la aplicación. Estos contienen la lógica de negocio y se comunican con los repositorios para procesar datos.</p><p>Se utiliza la anotación <code>@Service</code> para indicar que esta clase forma parte de la capa de servicios de la aplicación, además del <code>@AllArgsConstructor</code> de <code>lombok</code>.</p><blockquote><p>Como el archivo es muy extenso, pongo un fragmento de él. Para facilitar la lectura, se han <em>eliminado algunos imports</em> relacionados con modelos y excepciones.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.services</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Objects</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Optional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.stereotype.Service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.Logger</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.LoggerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.domain.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.transaction.Transactional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ServicioPrestamos</span><span class=p>{</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PrestamosRepository</span><span class=w> </span><span class=n>repository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>LibrosRepository</span><span class=w> </span><span class=n>repoLibro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UsuariosRepository</span><span class=w> </span><span class=n>userRepo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>ServicioPrestamos</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPrestamos</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Pageable</span><span class=w> </span><span class=n>paginable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>PageRequest</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=n>size</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=na>findAll</span><span class=p>(</span><span class=n>paginable</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Prestamo</span><span class=w> </span><span class=nf>getPrestamoId</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PrestamoNotFoundException</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>prestamo</span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Transactional</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>postPrestamo</span><span class=p>(</span><span class=n>Prestamo</span><span class=w> </span><span class=n>prestamo</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repoLibro</span><span class=p>.</span><span class=na>findByIsbn</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getLibro</span><span class=p>().</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Usuario</span><span class=w> </span><span class=n>usuario</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userRepo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>().</span><span class=na>getMatricula</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=kt>int</span><span class=w> </span><span class=n>cantidad</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>libro</span><span class=p>.</span><span class=na>getDisponibles</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Servicio postPrestamo&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamoExistente</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Cantidad: &#34;</span><span class=o>+</span><span class=n>cantidad</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>prestamoExistente</span><span class=p>.</span><span class=na>isPresent</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PrestamoConflictException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getId</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=p>(</span><span class=n>cantidad</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>LibroNoDisponibleException</span><span class=p>(</span><span class=n>libro</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>usuario</span><span class=p>.</span><span class=na>getPor_devolver</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UsuarioDevolucionesPendientesException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>().</span><span class=na>getMatricula</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>usuario</span><span class=p>.</span><span class=na>getSancion</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UsuarioSancionadoException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>().</span><span class=na>getMatricula</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>if</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_devolucion</span><span class=p>().</span><span class=na>isBefore</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_prestamo</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>FechasNoValidasException</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_prestamo</span><span class=p>(),</span><span class=w> </span><span class=n>prestamo</span><span class=p>.</span><span class=na>getFecha_devolucion</span><span class=p>());</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>libro</span><span class=p>.</span><span class=na>setDisponibles</span><span class=p>(</span><span class=n>cantidad</span><span class=o>-</span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Cantidad: &#34;</span><span class=o>+</span><span class=w> </span><span class=n>libro</span><span class=p>.</span><span class=na>getDisponibles</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>repoLibro</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>libro</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>repository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>prestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>He incluido tres métodos distintos, del más sencillo al más complejo:</p><ul><li><code>getPrestamos</code>: nos devuelve todos los préstamos de la base de datos. Solo declaramos un <code>Pageable</code> para poder utilizar la paginación, y devolvemos lo que retorne el repositorio.</li><li><code>getPrestamoId</code>: nos devuelve un préstamo por su identificador. Utilizamos un <code>Optional</code> para gestionar la posible ausencia del recurso, lanzando una excepción personalizada (que recibirá el controlador) en caso de que no se encuentre el préstamo.</li><li><code>postPrestamo</code>: nos permite crear un nuevo préstamo. Al ser un método que modifica la base de datos, se anota como <code>@Transactional</code>. Se reciben los datos desde el controlador (en formato JSON), se extraen las entidades asociadas y se realizan múltiples validaciones: existencia del préstamo, disponibilidad del libro, situación del usuario, y consistencia entre fechas. Si todo es correcto, se actualiza la cantidad de ejemplares disponibles y se guarda el préstamo.</li></ul><h3 class=heading-element id=controladores><span>4.4 Controladores</span>
<a href=#controladores class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Por último, se describen los controladores que componen la aplicación. Estos se encargan de gestionar las peticiones y respuestas HTTP, conectando al cliente con la lógica del servicio.</p><p>Se utiliza la anotación <code>@RestController</code> para indicar que esta clase forma parte de la capa de controladores de la aplicación, además del <code>@AllArgsConstructor</code> de <code>lombok</code> y del <code>@RequestMapping</code> para indicar el <strong>entry point</strong> al recurso.</p><blockquote><p>Igual que en el caso de los servicios, pongo un fragmento del controlador, eliminando algunos imports.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.controllers</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>jakarta.validation.Valid</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.domain.Page</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.data.web.PagedResourcesAssembler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.methodOn</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.AllArgsConstructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.ResponseEntity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.Logger</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.slf4j.LoggerFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s>&#34;/biblioteca.api/prestamos&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamosController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>ServicioPrestamos</span><span class=w> </span><span class=n>servicio</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>PagedResourcesAssembler</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>pagedResourcesAssembler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>PrestamoModelAssembler</span><span class=w> </span><span class=n>prestamoModelAssembler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>logger</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>PrestamosController</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getPrestamos</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>page</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nd>@RequestParam</span><span class=p>(</span><span class=n>defaultValue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;3&#34;</span><span class=p>,</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>size</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Page</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>getPrestamos</span><span class=p>(</span><span class=n>page</span><span class=p>,</span><span class=w> </span><span class=n>size</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>ok</span><span class=p>(</span><span class=n>pagedResourcesAssembler</span><span class=p>.</span><span class=na>toModel</span><span class=p>(</span><span class=n>prestamos</span><span class=p>,</span><span class=w> </span><span class=n>prestamoModelAssembler</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PutMapping</span><span class=p>(</span><span class=s>&#34;/{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>devolverLibro_verificarDevolucion</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=nd>@Valid</span><span class=w> </span><span class=nd>@RequestBody</span><span class=w> </span><span class=n>Prestamo</span><span class=w> </span><span class=n>prestamo</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>prestamo</span><span class=p>.</span><span class=na>isDevuelto</span><span class=p>()){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>//parte a devolver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>servicio</span><span class=p>.</span><span class=na>devolverLibro</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>prestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>noContent</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoDevueltoException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>             </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>UsuarioNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>LibroNoCoincideException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>//parte de verificar devolucion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>servicio</span><span class=p>.</span><span class=na>verificarDevolucion</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>prestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>noContent</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>catch</span><span class=p>(</span><span class=n>PrestamoVerificadoException</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>UsuarioNoCoincideException</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>LibroNoCoincideException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@DeleteMapping</span><span class=p>(</span><span class=s>&#34;/{id}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>deletePrestamo</span><span class=p>(</span><span class=nd>@PathVariable</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>servicio</span><span class=p>.</span><span class=na>deletePrestamo</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>noContent</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>ResponseEntity</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>body</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Igual que antes, he incluido tres métodos distintos, del más sencillo al más complejo:</p><ul><li><code>getPrestamos</code>: llamamos al método del servicio con los parámetros de la petición (el <code>page</code> y el <code>size</code>) que por defecto son 0 y 3, y devolvemos el resultado de la llamada.</li><li><code>devolverLibro_verificarDevolucion</code>: nos permite devolver un libro o verificar la devolución de un préstamo. Este método como si que puede lanzar excepciones, lo envolvemos en un <code>try-catch</code> para poder devolver el mensaje de error en caso de que ocurra alguna excepción, separando las excepciones en función del código de error HTTP que devuelva.</li><li><code>deletePrestamo</code>: nos permite eliminar un préstamo. Llamamos al método del servicio con el identificador del préstamo y devolvemos el resultado de la llamada. Si no existía el préstamo, captura la excepción y devuelve código de estado HTTP 404 Not Found.</li></ul><h3 class=heading-element id=excepciones><span>4.5 Excepciones</span>
<a href=#excepciones class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h3><p>Para gestionar los errores de manera controlada y coherente, definimos un sistema de excepciones personalizado. Para cada recurso de la aplicación, se crea un paquete específico que contiene dos tipos de archivos:</p><ul><li><strong>Clases de excepción personalizadas</strong>, una por cada tipo de error que pueda producirse en ese recurso.</li><li>Un <strong>manejador centralizado de excepciones</strong>, que captura las excepciones lanzadas y devuelve una respuesta HTTP en formato JSON al cliente.</li></ul><p>Un ejemplo de clase de excepción sería el siguiente:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.Excepciones.Prestamos</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamoNotFoundException</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>RuntimeException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>PrestamoNotFoundException</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>(</span><span class=n>construirMensaje</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>isbn</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>construirMensaje</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>==</span><span class=w>  </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=s>&#34;No se pudo encontrar el prestamo con matricula &#34;</span><span class=o>+</span><span class=n>matricula</span><span class=o>+</span><span class=s>&#34; e isbn &#34;</span><span class=o>+</span><span class=n>isbn</span><span class=o>+</span><span class=s>&#34;.&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=s>&#34;No se pudo encontrar el prestamo con id &#34;</span><span class=o>+</span><span class=n>id</span><span class=o>+</span><span class=s>&#34;.&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Se define una excepción que se lanza si no se encuentra el préstamo. El método <code>construirMensaje</code> nos permite construir el mensaje de error de forma dinámica, dependiendo de si se especificó el identificador del recurso o no.</p><p>Por otro lado, tenemos el archivo de manejador de excepciones (en este caso <code>PrestamosExcepciones.java</code>), anotado con <code>@RestControllerAdvice</code> para capturar y manejar las excepciones relacionadas con préstamos y devolver una respuesta HTTP en formato JSON:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.Excepciones.Prestamos</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.Excepciones.ErrorMessage</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.ExceptionHandler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.ResponseStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.RestControllerAdvice</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestControllerAdvice</span><span class=c1>//Captura excepciones de toda la aplicación y devuelve JSON</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PrestamosExcepciones</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoNotFoundContentException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoNotFoundContentException</span><span class=p>(</span><span class=n>PrestamoNotFoundContentException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>FechaDevolucionException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>FechaDevolucionException</span><span class=p>(</span><span class=n>FechaDevolucionException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoNotFoundException</span><span class=p>(</span><span class=n>PrestamoNotFoundException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoConflictException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoConflictException</span><span class=p>(</span><span class=n>PrestamoConflictException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoVerificadoException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoVerificadoException</span><span class=p>(</span><span class=n>PrestamoVerificadoException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>LibroNoDisponibleException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>LibroNoDisponibleException</span><span class=p>(</span><span class=n>LibroNoDisponibleException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>UsuarioDevolucionesPendientesException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>UsuarioDevolucionesPendientesException</span><span class=p>(</span><span class=n>UsuarioDevolucionesPendientesException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>UsuarioSancionadoException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>FORBIDDEN</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>UsuarioSancionadoException</span><span class=p>(</span><span class=n>UsuarioSancionadoException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoDevueltoException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>CONFLICT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoDevueltoException</span><span class=p>(</span><span class=n>PrestamoDevueltoException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoFechaPrestamoNoCoincideException</span><span class=p>(</span><span class=n>PrestamoFechaPrestamoNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>PrestamoFechaDevolucionNoCoincideException</span><span class=p>(</span><span class=n>PrestamoFechaDevolucionNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>UsuarioNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>UsuarioNoCoincideException</span><span class=p>(</span><span class=n>UsuarioNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ExceptionHandler</span><span class=p>(</span><span class=n>LibroNoCoincideException</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseStatus</span><span class=p>(</span><span class=n>HttpStatus</span><span class=p>.</span><span class=na>BAD_REQUEST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ErrorMessage</span><span class=w> </span><span class=nf>LibroNoCoincideException</span><span class=p>(</span><span class=n>LibroNoCoincideException</span><span class=w> </span><span class=n>ex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ErrorMessage</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>En cada método del manejador:</p><ul><li>Indicamos con la anotación <code>@ExceptionHandler</code> la clase de la excepción que se desea capturar.</li><li>Con en la anotación <code>@ResponseStatus</code> se especifica el código de error HTTP que devuelve.</li><li>Devolvemos un objeto <code>ErrorMessage</code> con el mensaje de error, el cual se devuelve en formato JSON.</li></ul><hr><h2 class=heading-element id=cliente><span>5 Cliente</span>
<a href=#cliente class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Para crear el cliente que consumirá la API RESTful, creamos un nuevo proyecto <strong>Spring</strong>. Estructuramos el código en <em>dos carpetas</em>:</p><ul><li><code>models</code>: contiene las entidades, sus versiones paginables, y algunas clases auxiliares como <code>href</code>, <code>ResourceLink</code> y <code>Pagelinks</code>.</li><li><code>service</code>: define los métodos que realizan las operaciones sobre la API RESTful (<code>post</code>, <code>get</code>, <code>put</code>, <code>delete</code>).</li></ul><p>Fuera de estas carpetas, en el mismo nivel, se encuentra el archivo <code>ClienteApplication.java</code>, el cual es el punto de entrada del cliente, y en el que invocamos a los métodos definidos en <code>service</code>.</p><p>Para empezar, en la carpeta <code>models</code> definimos los atributos de cada clase. Por ejemplo, la de <code>Prestamo</code> sería igual que antes, pero añadiendo el atributo <code>_links</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.fasterxml.jackson.annotation.JsonProperty</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Prestamo</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Usuario</span><span class=w> </span><span class=n>usuario</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fecha_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>devuelto</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>verificar_devolucion</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>ampliar</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JsonProperty</span><span class=p>(</span><span class=s>&#34;_links&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>ResourceLink</span><span class=w> </span><span class=n>_links</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>La clase <code>ResourceLink</code> se compone de un objeto <code>Href</code>, que encapsula una URL como <code>string</code>. En cuanto a <code>Pagelinks</code>, es una clase que contiene referencias para la navegación paginada de resultados:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>lombok.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@NoArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@AllArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PageLinks</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>first</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>self</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>next</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Href</span><span class=w> </span><span class=n>last</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Dentro de la carpeta <code>service</code>, tenemos un único archivo <code>BibliotecaService.java</code> que implementa los métodos para interactuar con los distintos endpoints de la API RESTful.</p><blockquote><p>Como en anteriores ocasiones, para facilitar la lectura pongo un fragmento representativo del archivo completo.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.service</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Map</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatus</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.MediaType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpStatusCode</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.reactive.function.client.WebClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.Libro</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.Prestamo</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.Usuario</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>reactor.core.publisher.Mono</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>BibliotecaService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>WebClient</span><span class=w> </span><span class=n>webClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WebClient</span><span class=p>.</span><span class=na>builder</span><span class=p>().</span><span class=na>baseUrl</span><span class=p>(</span><span class=s>&#34;http://localhost:8080/biblioteca.api&#34;</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>getUsuario</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Usuario</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webClient</span><span class=p>.</span><span class=na>get</span><span class=p>().</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/users/{matricula}&#34;</span><span class=p>,</span><span class=n>matricula</span><span class=p>).</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is5xxServerError</span><span class=p>,</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 5xx&#34;</span><span class=o>+</span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>Usuario</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>user</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>selfLink</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>user</span><span class=p>.</span><span class=na>get_links</span><span class=p>().</span><span class=na>getFirstHref</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Usuario con matricula: &#34;</span><span class=o>+</span><span class=n>user</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=o>+</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34; y correo: &#34;</span><span class=o>+</span><span class=n>user</span><span class=p>.</span><span class=na>getCorreo</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; se encuentra disponible en el link: &#34;</span><span class=o>+</span><span class=w> </span><span class=n>selfLink</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Usuario no encontrado&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>postPrestamo</span><span class=p>(</span><span class=n>Usuario</span><span class=w> </span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=p>,</span><span class=w> </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>devuelto</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>verificarDevolucion</span><span class=p>,</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=n>ampliar</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Prestamo</span><span class=w> </span><span class=n>prestamo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Prestamo</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setUsuario</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setLibro</span><span class=p>(</span><span class=n>libro</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setFecha_prestamo</span><span class=p>(</span><span class=n>fechaPrestamo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setFecha_devolucion</span><span class=p>(</span><span class=n>fechaDevolucion</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setDevuelto</span><span class=p>(</span><span class=n>devuelto</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setVerificar_devolucion</span><span class=p>(</span><span class=n>verificarDevolucion</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>prestamo</span><span class=p>.</span><span class=na>setAmpliar</span><span class=p>(</span><span class=n>ampliar</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>referencia</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>webClient</span><span class=p>.</span><span class=na>post</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/prestamos&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>prestamo</span><span class=p>),</span><span class=w> </span><span class=n>Prestamo</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=o>+</span><span class=n>body</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>toBodilessEntity</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>getLocation</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>return</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>getLocation</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=s>&#34;No se recibió URL en la cabecera Location&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>referencia</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>referencia</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>partes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>referencia</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&#34;/&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>partes</span><span class=o>[</span><span class=n>partes</span><span class=p>.</span><span class=na>length</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>1</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>RuntimeException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error: &#34;</span><span class=o>+</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>putLibro</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>isbn</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>titulo</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>autores</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>edicion</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>editorial</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>disponibles</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>unidades</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setIsbn</span><span class=p>(</span><span class=n>isbn</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setTitulo</span><span class=p>(</span><span class=n>titulo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setAutores</span><span class=p>(</span><span class=n>autores</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setEdicion</span><span class=p>(</span><span class=n>edicion</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setEditorial</span><span class=p>(</span><span class=n>editorial</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setDisponibles</span><span class=p>(</span><span class=n>disponibles</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>libro</span><span class=p>.</span><span class=na>setUnidades</span><span class=p>(</span><span class=n>unidades</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webClient</span><span class=p>.</span><span class=na>put</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/libros/{isbn}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>isbn</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>contentType</span><span class=p>(</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>body</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>just</span><span class=p>(</span><span class=n>libro</span><span class=p>),</span><span class=n>Usuario</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is5xxServerError</span><span class=p>,</span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 5xx&#34;</span><span class=o>+</span><span class=n>body</span><span class=p>)).</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>).</span><span class=na>toBodilessEntity</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deleteUsuario</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>matricula</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>webClient</span><span class=p>.</span><span class=na>delete</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>uri</span><span class=p>(</span><span class=s>&#34;/users/{matricula}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>matricula</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>retrieve</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>onStatus</span><span class=p>(</span><span class=n>HttpStatusCode</span><span class=p>::</span><span class=n>is4xxClientError</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>bodyToMono</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>doOnNext</span><span class=p>(</span><span class=n>body</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>err</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Error 4xx: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>body</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>then</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=na>empty</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>toBodilessEntity</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>block</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;El Usuario con matricula &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; ha sido eliminado.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>He incluido las cuatro operaciones CRUD para ilustrar los distintos casos de uso. Como se puede observar, se invoca a <code>webClient</code> con la operación a realizar, se pasa la URI con su parámetro (si aplica), se envía la petición con <code>retrieve()</code>, se gestiona el posible error con <code>onStatus()</code> y <code>doOnNext()</code>, y finalmente se procesa la respuesta con <code>bodyToMono()</code> o <code>toBodilessEntity()</code>, seguido de <code>block()</code> para obtener el resultado de forma síncrona.</p><p>En cuanto al <code>ClienteApplication.java</code>, consiste en una batería de pruebas que se encargan de probar cada método de la API RESTful. Aquí muestro un fragmento del código de este archivo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.time.LocalDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.ArrayList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.SpringApplication</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.autoconfigure.SpringBootApplication</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.models.*</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>es.upm.sos.biblioteca.cliente.service.BibliotecaService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@SpringBootApplication</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ClienteApplication</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=n>BibliotecaService</span><span class=w> </span><span class=n>servicio</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BibliotecaService</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;===== INICIO DEL TEST DE OPERACIONES =====&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>SpringApplication</span><span class=p>.</span><span class=na>run</span><span class=p>(</span><span class=n>ClienteApplication</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>args</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] POST de Usuarios\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadir 2 usuarios&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>nombres</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;Ana&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Luis&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>correos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;correo1@correo.com&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;correo2@correo.com&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>2</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Usuario con matricula: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y nombre: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>nombres</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>aux</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>matricula</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>servicio</span><span class=p>.</span><span class=na>postUsuario</span><span class=p>(</span><span class=n>aux</span><span class=p>,</span><span class=w> </span><span class=n>nombres</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>correos</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1990-01-01&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>matricula</span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] GET de Usuarios\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\t[-] GET de Usuario con matricula 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Usuario con matricula 2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getUsuario</span><span class=p>(</span><span class=s>&#34;2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] POST de libros\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadir cuatro libros&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>isbn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=s>&#34;2&#34;</span><span class=p>,</span><span class=s>&#34;3&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;4&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>titulos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;King pantera&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Amongus&#34;</span><span class=p>,</span><span class=s>&#34;Terrence McKenna&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;pedro sanchez ~ final electrica&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>autores</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=s>&#34;King&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Miguel de Cervantes&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Abderraman III&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;Kevin Roldan&#34;</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>ediciones</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>editoriales</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>4</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Libro con isbn: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>isbn</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y titulo: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>titulos</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>servicio</span><span class=p>.</span><span class=na>postLibro</span><span class=p>(</span><span class=n>isbn</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>titulos</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>ediciones</span><span class=p>,</span><span class=w> </span><span class=n>editoriales</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] GET de Libros\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Libros con isbn 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getLibro</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Libros con isbn 4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getLibro</span><span class=p>(</span><span class=s>&#34;4&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET de Libros con filtrado por titulo =&gt; &#39;pedro&#39;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getPorTitulo</span><span class=p>(</span><span class=s>&#34;pedro&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\t[-] GET unidades del Libro con isbn 1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Integer</span><span class=w> </span><span class=n>unidades</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>getLibroUnidades</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Unidades del libro con isbn 1: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>unidades</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//___________________________________________________________________________________________________________________________________________________________________</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] POST de prestamos\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Prestamo</span><span class=o>&gt;</span><span class=w> </span><span class=n>prestamo1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Usuario</span><span class=w> </span><span class=n>user1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Usuario</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=s>&#34;Ana&#34;</span><span class=p>,</span><span class=s>&#34;correo1@correo.com&#34;</span><span class=p>,</span><span class=s>&#34;1990-01-01&#34;</span><span class=p>,</span><span class=kc>null</span><span class=p>,</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>prestamo1</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>(</span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>titulos</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>(</span><span class=s>&#34;2&#34;</span><span class=p>,</span><span class=n>titulos</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Libro</span><span class=w> </span><span class=n>libro3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Libro</span><span class=p>(</span><span class=s>&#34;3&#34;</span><span class=p>,</span><span class=n>titulos</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=n>autores</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>LocalDate</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>LocalDate</span><span class=p>.</span><span class=na>now</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=n>ids</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>int</span><span class=o>[</span><span class=n>3</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Prestamo con usuario: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user1</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y libro: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>libro1</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ids</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>postPrestamo</span><span class=p>(</span><span class=n>user1</span><span class=p>,</span><span class=w> </span><span class=n>libro1</span><span class=p>,</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>,</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>.</span><span class=na>plusWeeks</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Prestamo con usuario: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user1</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y libro: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>libro2</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ids</span><span class=o>[</span><span class=n>1</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>postPrestamo</span><span class=p>(</span><span class=n>user1</span><span class=p>,</span><span class=w> </span><span class=n>libro2</span><span class=p>,</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>,</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>.</span><span class=na>plusWeeks</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;Añadiendo Prestamo con usuario: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>user1</span><span class=p>.</span><span class=na>getMatricula</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34; y libro: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>libro3</span><span class=p>.</span><span class=na>getIsbn</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ids</span><span class=o>[</span><span class=n>2</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>servicio</span><span class=p>.</span><span class=na>postPrestamo</span><span class=p>(</span><span class=n>user1</span><span class=p>,</span><span class=w> </span><span class=n>libro3</span><span class=p>,</span><span class=w> </span><span class=n>fechaPrestamo</span><span class=p>.</span><span class=na>minusMonths</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=n>fechaDevolucion</span><span class=p>.</span><span class=na>minusMonths</span><span class=p>(</span><span class=n>1</span><span class=p>),</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;\n\n[+] GET de Prestamos\n&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>servicio</span><span class=p>.</span><span class=na>getPrestamo</span><span class=p>(</span><span class=n>ids</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Como se puede apreciar, se realizan las operaciones estándar para la creación y consulta de <strong>usuarios</strong>, <strong>libros</strong> y <strong>préstamos</strong>, cubriendo así los casos típicos de uso de la aplicación.</p><p>Para verlo en acción podéis consultar la sección <a href=#ejemplo-de-uso>Ejemplo de uso</a>.</p><hr><h2 class=heading-element id=uso><span>6 Uso</span>
<a href=#uso class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Para ejecutar el proyecto usamos <code>Docker</code>. Ya que tenemos un <code>Dockerfile</code> y un <code>docker-compose.yaml</code>, podemos ejecutar el servicio con el siguiente comando:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose up -d</span></span></code></pre></td></tr></table></div></div><p>(O sin el flag <code>-d</code>). Esto lanzará <em>dos contenedores</em>:</p><ul><li>Uno para el backend de la aplicación, accesible desde el puerto <code>8080</code>.</li><li>Otro para la base de datos <code>PostgreSQL</code>.</li></ul><p>Ahora para ejecutar el cliente tenemos dos opciones, o bien nos vamos al archivo y lo ejecutamos directamente o podemos hacer uso del <code>script.sh</code> que se encuentra en el directorio raíz del repositorio. Este script lanzará el servicio (si no está corriendo) y ejecutará el cliente.</p><blockquote><p><strong>Nota:</strong> Asegúrate de estar en la raíz del proyecto para que el script funcione correctamente.</p></blockquote><h2 class=heading-element id=ejemplo-de-uso><span>7 Ejemplo de uso</span>
<a href=#ejemplo-de-uso class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>En esta sección se muestran algunos ejemplos de como interactuar con la API, todos extraídos del <a href=#cliente>cliente</a>. En mi caso uso <code>Postman</code>, pero puedes usar cualquier cliente REST.</p><blockquote><p>Para la ejecución del cliente se utilizan <strong>break points</strong> después de cada bloque de operaciones.</p></blockquote><p>Iniciamos la ejecución del cliente:</p><p><a class=lightgallery href=/es/posts/sos/images/image.png title=Ejecución data-thumbnail=/es/posts/sos/images/image.png data-sub-html="<h2>Ejecución</h2>"><img loading=lazy src=/es/posts/sos/images/image.png alt=Ejecución height=815 width=1448></a></p><p>Creamos 2 usuarios (POST):</p><p><a class=lightgallery href=/es/posts/sos/images/image1.png title="POST Usuarios" data-thumbnail=/es/posts/sos/images/image1.png data-sub-html="<h2>POST Usuarios</h2>"><img loading=lazy src=/es/posts/sos/images/image1.png alt="POST Usuarios" height=779 width=1382></a></p><p>Hacemos el GET de cada uno:</p><p><a class=lightgallery href=/es/posts/sos/images/image2.png title="GET Usuarios" data-thumbnail=/es/posts/sos/images/image2.png data-sub-html="<h2>GET Usuarios</h2>"><img loading=lazy src=/es/posts/sos/images/image2.png alt="GET Usuarios" height=618 width=674></a> <a class=lightgallery href=/es/posts/sos/images/image3.png title="GET Usuarios" data-thumbnail=/es/posts/sos/images/image3.png data-sub-html="<h2>GET Usuarios</h2>"><img loading=lazy src=/es/posts/sos/images/image3.png alt="GET Usuarios" height=620 width=679></a></p><p>Creamos 3 libros (POST):</p><p><a class=lightgallery href=/es/posts/sos/images/image4.png title="POST Libros" data-thumbnail=/es/posts/sos/images/image4.png data-sub-html="<h2>POST Libros</h2>"><img loading=lazy src=/es/posts/sos/images/image4.png alt="POST Libros" height=778 width=1383></a></p><p>Se muestran los 3 primeros libros (page=0&amp;size=3).</p><p>A continuación, las operaciones GET de la anterior captura (las mostradas por consola).</p><p>GET del libro con ISBN 1:</p><p><a class=lightgallery href=/es/posts/sos/images/image5.png title="GET Libro 1" data-thumbnail=/es/posts/sos/images/image5.png data-sub-html="<h2>GET Libro 1</h2>"><img loading=lazy src=/es/posts/sos/images/image5.png alt="GET Libro 1" height=414 width=1445></a></p><p>GET del libro con ISBN 4:</p><p><a class=lightgallery href=/es/posts/sos/images/image6.png title="GET Libro 4" data-thumbnail=/es/posts/sos/images/image6.png data-sub-html="<h2>GET Libro 4</h2>"><img loading=lazy src=/es/posts/sos/images/image6.png alt="GET Libro 4" height=475 width=1644></a></p><p>GET del libro filtrado por nombre:</p><p><a class=lightgallery href=/es/posts/sos/images/image7.png title="GET Libro filtrado" data-thumbnail=/es/posts/sos/images/image7.png data-sub-html="<h2>GET Libro filtrado</h2>"><img loading=lazy src=/es/posts/sos/images/image7.png alt="GET Libro filtrado" height=687 width=1645></a></p><p>GET de las unidades del libro con ISBN 1:</p><p><a class=lightgallery href=/es/posts/sos/images/image8.png title="GET Unidades" data-thumbnail=/es/posts/sos/images/image8.png data-sub-html="<h2>GET Unidades</h2>"><img loading=lazy src=/es/posts/sos/images/image8.png alt="GET Unidades" height=336 width=1645></a></p><p>Creamos 3 préstamos (POST):</p><p><a class=lightgallery href=/es/posts/sos/images/image9.png title="POST Prestamos" data-thumbnail=/es/posts/sos/images/image9.png data-sub-html="<h2>POST Prestamos</h2>"><img loading=lazy src=/es/posts/sos/images/image9.png alt="POST Prestamos" height=926 width=1646></a>
<a class=lightgallery href=/es/posts/sos/images/image10.png title="Postman Prestamos" data-thumbnail=/es/posts/sos/images/image10.png data-sub-html="<h2>Postman Prestamos</h2>"><img loading=lazy src=/es/posts/sos/images/image10.png alt="Postman Prestamos" height=928 width=1646></a></p><p>GET del préstamo con id=1:</p><p><a class=lightgallery href=/es/posts/sos/images/image11.png title="GET Prestamo 1" data-thumbnail=/es/posts/sos/images/image11.png data-sub-html="<h2>GET Prestamo 1</h2>"><img loading=lazy src=/es/posts/sos/images/image11.png alt="GET Prestamo 1" height=790 width=768></a></p><p>Actualizamos un usuario y un libro (PUT):</p><p><a class=lightgallery href=/es/posts/sos/images/image12.png title="PUT Usuario" data-thumbnail=/es/posts/sos/images/image12.png data-sub-html="<h2>PUT Usuario</h2>"><img loading=lazy src=/es/posts/sos/images/image12.png alt="PUT Usuario" height=207 width=1646></a>
<a class=lightgallery href=/es/posts/sos/images/image13.png title=Consola data-thumbnail=/es/posts/sos/images/image13.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image13.png alt=Consola height=470 width=1646></a></p><p>Verificamos el cambio del usuario en el Postman:</p><p><a class=lightgallery href=/es/posts/sos/images/image14.png title=Postman data-thumbnail=/es/posts/sos/images/image14.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image14.png alt=Postman height=821 width=706></a></p><p>Verificamos el cambio del libro en el Postman:</p><p><a class=lightgallery href=/es/posts/sos/images/image15.png title=Postman data-thumbnail=/es/posts/sos/images/image15.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image15.png alt=Postman height=401 width=1648></a></p><p>Borramos el usuario con matrícula 2:</p><p><a class=lightgallery href=/es/posts/sos/images/image16.png title="DELETE Usuario" data-thumbnail=/es/posts/sos/images/image16.png data-sub-html="<h2>DELETE Usuario</h2>"><img loading=lazy src=/es/posts/sos/images/image16.png alt="DELETE Usuario" height=194 width=1002></a>
<a class=lightgallery href=/es/posts/sos/images/image17.png title=Consola data-thumbnail=/es/posts/sos/images/image17.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image17.png alt=Consola height=195 width=467></a></p><p>Verificamos la existencia del usuario 2:</p><p><a class=lightgallery href=/es/posts/sos/images/image18.png title=Postman data-thumbnail=/es/posts/sos/images/image18.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image18.png alt=Postman height=836 width=701></a></p><p>Hacemos todas las operaciones GET posibles:</p><p><a class=lightgallery href=/es/posts/sos/images/image19.png title=GET data-thumbnail=/es/posts/sos/images/image19.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/es/posts/sos/images/image19.png alt=GET height=924 width=1645></a></p><p>Verificamos el GET de los usuarios, en este caso solo hay uno ya que el otro lo borramos:</p><p><a class=lightgallery href=/es/posts/sos/images/image20.png title=GET data-thumbnail=/es/posts/sos/images/image20.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/es/posts/sos/images/image20.png alt=GET height=865 width=1540></a></p><p>Verificamos el GET de los libros:</p><p><a class=lightgallery href=/es/posts/sos/images/image21.png title=GET data-thumbnail=/es/posts/sos/images/image21.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/es/posts/sos/images/image21.png alt=GET height=858 width=1525></a></p><p>Verificamos el GET de los préstamos:</p><p><a class=lightgallery href=/es/posts/sos/images/image22.png title=GET data-thumbnail=/es/posts/sos/images/image22.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/es/posts/sos/images/image22.png alt=GET height=838 width=1495></a></p><p>Verificamos el GET de los préstamos de un usuario:</p><p><a class=lightgallery href=/es/posts/sos/images/image23.png title=GET data-thumbnail=/es/posts/sos/images/image23.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/es/posts/sos/images/image23.png alt=GET height=845 width=1507></a></p><p>Ahora vamos a hacer todos los PUT posibles sobre los préstamos, esto es, ampliar un préstamo, devolver un préstamo y verificar la devolución de un préstamo.</p><p>Ampliamos un préstamo (PUT):</p><p><a class=lightgallery href=/es/posts/sos/images/image24.png title="PUT Prestamo" data-thumbnail=/es/posts/sos/images/image24.png data-sub-html="<h2>PUT Prestamo</h2>"><img loading=lazy src=/es/posts/sos/images/image24.png alt="PUT Prestamo" height=162 width=1647></a>
<a class=lightgallery href=/es/posts/sos/images/image25.png title=Consola data-thumbnail=/es/posts/sos/images/image25.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image25.png alt=Consola height=105 width=1645></a></p><p>Verificamos que la ampliación de la fecha de devolución se haya realizado correctamente.
La fecha de devolución original del préstamo era LocalDate.now().plusWeeks(1). Dado que hoy es <strong>25/06</strong>, la fecha inicialmente era <strong>02/07</strong>. Tras realizar la ampliación (dos semanas adicionales), la nueva fecha de devolución esperada es <strong>16/07</strong>.</p><p><a class=lightgallery href=/es/posts/sos/images/image26.png title=Postman data-thumbnail=/es/posts/sos/images/image26.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image26.png alt=Postman height=915 width=757></a></p><p>Ahora probamos 2 casos que deberían devolver error:</p><p><a class=lightgallery href=/es/posts/sos/images/image27.png title="Casos de error" data-thumbnail=/es/posts/sos/images/image27.png data-sub-html="<h2>Casos de error</h2>"><img loading=lazy src=/es/posts/sos/images/image27.png alt="Casos de error" height=143 width=1509></a>
<a class=lightgallery href=/es/posts/sos/images/image28.png title=Consola data-thumbnail=/es/posts/sos/images/image28.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image28.png alt=Consola height=267 width=1508></a></p><p>Como se puede ver saltan los errores correspondientes. Si lo probamos en Postman nos sale lo mismo:</p><p><a class=lightgallery href=/es/posts/sos/images/image29.png title=Postman data-thumbnail=/es/posts/sos/images/image29.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image29.png alt=Postman height=595 width=705></a> <a class=lightgallery href=/es/posts/sos/images/image30.png title=Postman data-thumbnail=/es/posts/sos/images/image30.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image30.png alt=Postman height=598 width=767></a></p><p>Devolver un préstamo (PUT):</p><p><a class=lightgallery href=/es/posts/sos/images/image31.png title=PUT data-thumbnail=/es/posts/sos/images/image31.png data-sub-html="<h2>PUT</h2>"><img loading=lazy src=/es/posts/sos/images/image31.png alt=PUT height=123 width=1511></a></p><p>Verificamos:</p><p><a class=lightgallery href=/es/posts/sos/images/image32.png title=Postman data-thumbnail=/es/posts/sos/images/image32.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image32.png alt=Postman height=778 width=862></a></p><p>Ahora probamos 3 casos que deberían devolver error:</p><p><a class=lightgallery href=/es/posts/sos/images/image33.png title="Casos de error" data-thumbnail=/es/posts/sos/images/image33.png data-sub-html="<h2>Casos de error</h2>"><img loading=lazy src=/es/posts/sos/images/image33.png alt="Casos de error" height=213 width=1509></a>
<a class=lightgallery href=/es/posts/sos/images/image34.png title=Consola data-thumbnail=/es/posts/sos/images/image34.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image34.png alt=Consola height=158 width=1508></a></p><p>Como se observa, saltan los tres errores. Comprobamos en el Postman:</p><p>409 Conflict => ya ha sido devuelto:</p><p><a class=lightgallery href=/es/posts/sos/images/image35.png title=Postman data-thumbnail=/es/posts/sos/images/image35.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image35.png alt=Postman height=966 width=794></a></p><p>400 Bad Request => El prestamos con id: 1 tiene un libro diferente a la que se ha enviado. El ISBN del libro es 1 y el ISBN del libro que se ha enviado es 3.</p><p><a class=lightgallery href=/es/posts/sos/images/image36.png title=Postman data-thumbnail=/es/posts/sos/images/image36.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image36.png alt=Postman height=779 width=633></a></p><p>404 Not Found => No se pudo encontrar el préstamo con id 3.</p><p><a class=lightgallery href=/es/posts/sos/images/image37.png title=Postman data-thumbnail=/es/posts/sos/images/image37.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image37.png alt=Postman height=770 width=641></a></p><p>Verificar una devolución (PUT):</p><p><a class=lightgallery href=/es/posts/sos/images/image38.png title=PUT data-thumbnail=/es/posts/sos/images/image38.png data-sub-html="<h2>PUT</h2>"><img loading=lazy src=/es/posts/sos/images/image38.png alt=PUT height=72 width=1299></a>
<a class=lightgallery href=/es/posts/sos/images/image39.png title=Consola data-thumbnail=/es/posts/sos/images/image39.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image39.png alt=Consola height=218 width=1299></a></p><p>Verificamos:</p><p><a class=lightgallery href=/es/posts/sos/images/image40.png title=Postman data-thumbnail=/es/posts/sos/images/image40.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image40.png alt=Postman height=558 width=618></a></p><p>Al ser un préstamo caducado sin devolver, debería incrementarse el número de libros que tiene el usuario por devolver.</p><p><a class=lightgallery href=/es/posts/sos/images/image41.png title=Postman data-thumbnail=/es/posts/sos/images/image41.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image41.png alt=Postman height=445 width=621></a></p><p>Efectivamente, ha aumentado. Si ahora lo devolviese, el por_devolver decrementaría a 0 y se aplicaría la sanción.</p><p>Hacemos 3 llamadas erróneas de verificar devolución:</p><p><a class=lightgallery href=/es/posts/sos/images/image42.png title="Casos de error" data-thumbnail=/es/posts/sos/images/image42.png data-sub-html="<h2>Casos de error</h2>"><img loading=lazy src=/es/posts/sos/images/image42.png alt="Casos de error" height=181 width=1300></a>
<a class=lightgallery href=/es/posts/sos/images/image43.png title=Consola data-thumbnail=/es/posts/sos/images/image43.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image43.png alt=Consola height=140 width=1303></a></p><p>Como se observa, saltan los 3 errores. Comprobamos con el Postman:</p><p>409 Conflict => El prestamo con id: 3 no se puede verificar -> o bien ya se ha verificado o bien ya se ha devuelto o bien el prestamo aun no ha caducado.</p><p><a class=lightgallery href=/es/posts/sos/images/image44.png title=Postman data-thumbnail=/es/posts/sos/images/image44.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image44.png alt=Postman height=929 width=752></a></p><p>400 Bad Request => El prestamos con id: 3 tiene una fecha de prestamo diferente a la que se ha enviado. La fecha del prestamo es 2025-05-25 y la fecha del prestamo que se ha enviado es 2025-05-20.</p><p><a class=lightgallery href=/es/posts/sos/images/image45.png title=Postman data-thumbnail=/es/posts/sos/images/image45.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image45.png alt=Postman height=745 width=614></a></p><p>404 Not Found => No se pudo encontrar el prestamo con id 4.</p><p><a class=lightgallery href=/es/posts/sos/images/image46.png title=Postman data-thumbnail=/es/posts/sos/images/image46.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image46.png alt=Postman height=748 width=613></a></p><p>Ahora probamos a solicitar un préstamo con el usuario con libros pendientes de devolución y una vez devueltos.</p><p><a class=lightgallery href=/es/posts/sos/images/image47.png title="POST Prestamos" data-thumbnail=/es/posts/sos/images/image47.png data-sub-html="<h2>POST Prestamos</h2>"><img loading=lazy src=/es/posts/sos/images/image47.png alt="POST Prestamos" height=147 width=1301></a>
<a class=lightgallery href=/es/posts/sos/images/image48.png title=Consola data-thumbnail=/es/posts/sos/images/image48.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image48.png alt=Consola height=284 width=1295></a></p><p>Como se puede comprobar, efectivamente ambos dan error. Comprobamos en el postman:</p><p><a class=lightgallery href=/es/posts/sos/images/image49.png title=Postman data-thumbnail=/es/posts/sos/images/image49.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image49.png alt=Postman height=520 width=645></a> <a class=lightgallery href=/es/posts/sos/images/image50.png title=Postman data-thumbnail=/es/posts/sos/images/image50.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image50.png alt=Postman height=429 width=647></a></p><p>Para terminar, probamos diferentes métodos GET:</p><p><a class=lightgallery href=/es/posts/sos/images/image51.png title=GET data-thumbnail=/es/posts/sos/images/image51.png data-sub-html="<h2>GET</h2>"><img loading=lazy src=/es/posts/sos/images/image51.png alt=GET height=849 width=1446></a>
<a class=lightgallery href=/es/posts/sos/images/image52.png title=Consola data-thumbnail=/es/posts/sos/images/image52.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image52.png alt=Consola height=679 width=1443></a></p><p>Verificamos por orden según aparecen en la consola y código:</p><p><a class=lightgallery href=/es/posts/sos/images/image53.png title=Postman data-thumbnail=/es/posts/sos/images/image53.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image53.png alt=Postman height=762 width=1354></a>
<a class=lightgallery href=/es/posts/sos/images/image54.png title=Postman data-thumbnail=/es/posts/sos/images/image54.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image54.png alt=Postman height=219 width=1355></a>
<a class=lightgallery href=/es/posts/sos/images/image55.png title=Postman data-thumbnail=/es/posts/sos/images/image55.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image55.png alt=Postman height=761 width=1360></a>
<a class=lightgallery href=/es/posts/sos/images/image68.png title=Postman data-thumbnail=/es/posts/sos/images/image68.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image68.png alt=Postman height=704 width=1253></a>
<a class=lightgallery href=/es/posts/sos/images/image56.png title=Postman data-thumbnail=/es/posts/sos/images/image56.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image56.png alt=Postman height=699 width=1257></a></p><p>Devueltos:</p><p><a class=lightgallery href=/es/posts/sos/images/image57.png title=Postman data-thumbnail=/es/posts/sos/images/image57.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image57.png alt=Postman height=810 width=1444></a></p><p>Actividad:</p><p><a class=lightgallery href=/es/posts/sos/images/image58.png title=Postman data-thumbnail=/es/posts/sos/images/image58.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image58.png alt=Postman height=824 width=1445></a></p><p>Borramos los préstamos (DELETE):</p><p><a class=lightgallery href=/es/posts/sos/images/image59.png title=DELETE data-thumbnail=/es/posts/sos/images/image59.png data-sub-html="<h2>DELETE</h2>"><img loading=lazy src=/es/posts/sos/images/image59.png alt=DELETE height=230 width=990></a>
<a class=lightgallery href=/es/posts/sos/images/image60.png title=Consola data-thumbnail=/es/posts/sos/images/image60.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image60.png alt=Consola height=200 width=547></a>
<a class=lightgallery href=/es/posts/sos/images/image61.png title=Postman data-thumbnail=/es/posts/sos/images/image61.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image61.png alt=Postman height=341 width=1444></a></p><p>Borramos los Libros (DELETE):</p><p><a class=lightgallery href=/es/posts/sos/images/image62.png title=DELETE data-thumbnail=/es/posts/sos/images/image62.png data-sub-html="<h2>DELETE</h2>"><img loading=lazy src=/es/posts/sos/images/image62.png alt=DELETE height=220 width=736></a>
<a class=lightgallery href=/es/posts/sos/images/image63.png title=Consola data-thumbnail=/es/posts/sos/images/image63.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image63.png alt=Consola height=201 width=434></a>
<a class=lightgallery href=/es/posts/sos/images/image64.png title=Postman data-thumbnail=/es/posts/sos/images/image64.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image64.png alt=Postman height=338 width=1443></a></p><p>Borramos los Usuarios (DELETE):</p><p><a class=lightgallery href=/es/posts/sos/images/image65.png title=DELETE data-thumbnail=/es/posts/sos/images/image65.png data-sub-html="<h2>DELETE</h2>"><img loading=lazy src=/es/posts/sos/images/image65.png alt=DELETE height=164 width=714></a>
<a class=lightgallery href=/es/posts/sos/images/image66.png title=Consola data-thumbnail=/es/posts/sos/images/image66.png data-sub-html="<h2>Consola</h2>"><img loading=lazy src=/es/posts/sos/images/image66.png alt=Consola height=314 width=1042></a>
<a class=lightgallery href=/es/posts/sos/images/image67.png title=Postman data-thumbnail=/es/posts/sos/images/image67.png data-sub-html="<h2>Postman</h2>"><img loading=lazy src=/es/posts/sos/images/image67.png alt=Postman height=339 width=1444></a></p><p>Y fin del cliente.</p><h2 class=heading-element id=conclusión><span>8 Conclusión</span>
<a href=#conclusi%c3%b3n class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Este proyecto es un buen ejemplo de cómo podemos crear una API RESTful con <em>Spring Boot</em>. Es bastante completo, ya que abarca distintos aspectos como la arquitectura, el uso de patrones REST, el manejo centralizado de excepciones o la creación de un cliente para consumir la API.</p><p>Como siempre, puedes encontrar el código fuente en mi <a href=https://github.com/azuar4e/RESTful-Service target=_blank rel="external nofollow noopener noreferrer">repositorio de GitHub</a>.</p><p>Have a nice life! 👋</p></div><hr class=awesome-hr><h2 id=see-also>Contenido relacionado</h2><ul><li><a href=/es/posts/tdl/ title="Traductor De Lenguajes">Traductor De Lenguajes</a></li></ul><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Actualizado el 2025-07-25 15:00:00">Actualizado el 2025-07-25&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/es/posts/sos/index.md title="Leer Markdown" class=link-to-markdown>Leer Markdown</a></span><span><a href="https://github.com/azuar4e/azuar4e.github.io/blob/main/content/posts/university/sos/index.md?plain=1" title="Ver fuente" target=_blank rel="external nofollow noopener noreferrer" class=link-to-source>Ver fuente</a></span><span><a href=https://github.com/azuar4e/azuar4e.github.io/edit/main/content/posts/university/sos/index.md title="Editar esta página" target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>Editar esta página</a></span><span><a href="https://github.com/azuar4e/azuar4e.github.io/issues/new?title=[BUG]%20Servicio+RESTful&amp;body=%7cField%7cValue%7c%0A%7c-%7c-%7c%0A%7cTitle%7cServicio+RESTful%7c%0A%7cURL%7chttps://azuar4e.github.io/es/posts/sos/%7c%0A%7cFilename%7chttps://github.com/azuar4e/azuar4e.github.io/blob/main/content/posts/university/sos/index.md?plain=1%7c" title="Reportar problema" target=_blank rel="external nofollow noopener noreferrer" class=link-to-report>Reportar problema</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Compartir en X" data-sharer=twitter data-url=https://azuar4e.github.io/es/posts/sos/ data-title="Servicio RESTful" data-via=azuar4e data-hashtags=Java,Spring,API><i class="fa-brands fa-x-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartir en Linkedin" data-sharer=linkedin data-url=https://azuar4e.github.io/es/posts/sos/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartir en WhatsApp" data-sharer=whatsapp data-url=https://azuar4e.github.io/es/posts/sos/ data-title="Servicio RESTful" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartir en Reddit" data-sharer=reddit data-url=https://azuar4e.github.io/es/posts/sos/><i class="fa-brands fa-reddit fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/es/tags/java/ class=post-tag title="Etiquetas - Java">Java</a><a href=/es/tags/spring/ class=post-tag title="Etiquetas - Spring">Spring</a><a href=/es/tags/api/ class=post-tag title="Etiquetas - API">API</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Regresar</a></span>&nbsp;|&nbsp;<span><a href=/es/>Inicio</a></span></section></div><div class=post-nav><a href=/es/posts/tdl/ class=post-nav-item rel=prev title="Traductor De Lenguajes"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Traductor De Lenguajes</a></div></div></article><aside class=toc id=toc-auto aria-label=Contenido><h2 class=toc-title>Contenido&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside></main><footer class=footer><div class=footer-container><div class="footer-line powered order-1">Provisto por <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.147.8"><img class=hugo-icon src=/images/hugo.min.svg alt="Hugo logo"> Hugo</a> | Tema - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.3.21-b2e6f70a"><img class=fixit-icon src=/images/fixit.min.svg alt="FixIt logo"> FixIt</a></div><div class="footer-line copyright order-2" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2025</span><span class=author itemprop=copyrightHolder>
<a href=https://www.linkedin.com/in/angel-azuara/ target=_blank rel="external nofollow noopener noreferrer">Angel Azuara Eizaguirre</a></span></div><div class="footer-line statistics order-3"><span class=site-time title='El sitio se está ejecutando ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i><span class="run-times ms-1">El sitio se está ejecutando ...</span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Volver arriba"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://github.com/azuar4e/azuar4e.github.io title="View source on GitHub" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true" width="56" height="56"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#8581dd;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>Este sitio web funciona mejor con JavaScript habilitado.</div></noscript></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><link rel=stylesheet href=/lib/pace/themes/blue/pace-theme-minimal.css><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script src=/lib/autocomplete/autocomplete.min.js defer></script><script src=/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/lib/lightgallery/lightgallery.min.js defer></script><script src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/lib/sharer/sharer.min.js async defer></script><script src=/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/lib/pace/pace.min.js async defer></script><script>window.config={autoBookmark:!0,code:{copyTitle:"Copiar al portapapeles",maxShownLines:50},comment:{enable:!1},cookieconsent:{content:{dismiss:"De acuerdo",link:"Aprende más",message:"Este sitio web utiliza Cookies para mejorar su experiencia."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,search:{algoliaAppID:"L5YIFQ7E5O",algoliaIndex:"miblog_algolia_es",algoliaSearchKey:"4730818b3e23ce341fdbb2edbce34eda",highlightTag:"em",maxResultLength:10,noResultsFound:"No se encontraron resultados",snippetLength:50,type:"algolia"},siteTime:"2025-06-20T00:00:00+02:00",version:"v0.3.21-b2e6f70a"}</script><script src=/js/theme.min.js defer></script></body></html>